{"ast":null,"code":"import React,{useState,useEffect,useReducer,useRef}from\"react\";import{isSameDay,parseISO,format}from\"date-fns\";import openSocket from\"../../services/socket-io\";import clsx from\"clsx\";import{green}from\"@material-ui/core/colors\";import{Button,CircularProgress,Divider,IconButton,makeStyles}from\"@material-ui/core\";import{AccessTime,Block,Done,DoneAll,ExpandMore,GetApp}from\"@material-ui/icons\";import MarkdownWrapper from\"../MarkdownWrapper\";import VcardPreview from\"../VcardPreview\";import LocationPreview from\"../LocationPreview\";import ModalImageCors from\"../ModalImageCors\";import MessageOptionsMenu from\"../MessageOptionsMenu\";import whatsBackground from\"../../assets/wa-background.png\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";const useStyles=makeStyles(theme=>({messagesListWrapper:{overflow:\"hidden\",position:\"relative\",display:\"flex\",flexDirection:\"column\",flexGrow:1},messageCenter:{marginTop:5,alignItems:\"center\",verticalAlign:\"center\",alignContent:\"center\",backgroundColor:\"#E1F5FEEB\",fontSize:\"12px\",minWidth:100,maxWidth:270,color:\"#272727\",borderTopLeftRadius:0,borderTopRightRadius:8,borderBottomLeftRadius:8,borderBottomRightRadius:8,paddingLeft:5,paddingRight:5,paddingTop:5,paddingBottom:0,boxShadow:\"0 1px 1px #b3b3b3\"},messagesList:{backgroundImage:\"url(\".concat(whatsBackground,\")\"),display:\"flex\",flexDirection:\"column\",flexGrow:1,padding:\"20px 20px 20px 20px\",overflowY:\"scroll\",[theme.breakpoints.down(\"sm\")]:{paddingBottom:\"90px\"},...theme.scrollbarStyles},circleLoading:{color:green[500],position:\"absolute\",opacity:\"70%\",top:0,left:\"50%\",marginTop:12},messageLeft:{marginRight:20,marginTop:2,minWidth:100,maxWidth:600,height:\"auto\",display:\"block\",position:\"relative\",\"&:hover #messageActionsButton\":{display:\"flex\",position:\"absolute\",top:0,right:0},whiteSpace:\"pre-wrap\",backgroundColor:\"#ffffff\",color:\"#303030\",alignSelf:\"flex-start\",borderTopLeftRadius:0,borderTopRightRadius:8,borderBottomLeftRadius:8,borderBottomRightRadius:8,paddingLeft:5,paddingRight:5,paddingTop:5,paddingBottom:0,boxShadow:\"0 1px 1px #b3b3b3\"},quotedContainerLeft:{margin:\"-3px -80px 6px -6px\",overflow:\"hidden\",backgroundColor:\"#f0f0f0\",borderRadius:\"7.5px\",display:\"flex\",position:\"relative\"},quotedMsg:{padding:10,maxWidth:300,height:\"auto\",display:\"block\",whiteSpace:\"pre-wrap\",overflow:\"hidden\"},quotedSideColorLeft:{flex:\"none\",width:\"4px\",backgroundColor:\"#6bcbef\"},messageRight:{marginLeft:20,marginTop:2,minWidth:100,maxWidth:600,height:\"auto\",display:\"block\",position:\"relative\",\"&:hover #messageActionsButton\":{display:\"flex\",position:\"absolute\",top:0,right:0},whiteSpace:\"pre-wrap\",backgroundColor:\"#dcf8c6\",color:\"#303030\",alignSelf:\"flex-end\",borderTopLeftRadius:8,borderTopRightRadius:8,borderBottomLeftRadius:8,borderBottomRightRadius:0,paddingLeft:5,paddingRight:5,paddingTop:5,paddingBottom:0,boxShadow:\"0 1px 1px #b3b3b3\"},quotedContainerRight:{margin:\"-3px -80px 6px -6px\",overflowY:\"hidden\",backgroundColor:\"#cfe9ba\",borderRadius:\"7.5px\",display:\"flex\",position:\"relative\"},quotedMsgRight:{padding:10,maxWidth:300,height:\"auto\",whiteSpace:\"pre-wrap\"},quotedSideColorRight:{flex:\"none\",width:\"4px\",backgroundColor:\"#35cd96\"},messageActionsButton:{display:\"none\",position:\"relative\",color:\"#999\",zIndex:1,backgroundColor:\"inherit\",opacity:\"90%\",\"&:hover, &.Mui-focusVisible\":{backgroundColor:\"inherit\"}},messageContactName:{display:\"flex\",color:\"#6bcbef\",fontWeight:500},textContentItem:{overflowWrap:\"break-word\",padding:\"3px 80px 6px 6px\"},textContentItemDeleted:{fontStyle:\"italic\",color:\"rgba(0, 0, 0, 0.36)\",overflowWrap:\"break-word\",padding:\"3px 80px 6px 6px\"},messageMedia:{objectFit:\"cover\",width:250,height:200,borderTopLeftRadius:8,borderTopRightRadius:8,borderBottomLeftRadius:8,borderBottomRightRadius:8},timestamp:{fontSize:11,position:\"absolute\",bottom:0,right:5,color:\"#999\"},dailyTimestamp:{alignItems:\"center\",textAlign:\"center\",alignSelf:\"center\",width:\"110px\",backgroundColor:\"#e1f3fb\",margin:\"10px\",borderRadius:\"10px\",boxShadow:\"0 1px 1px #b3b3b3\"},dailyTimestampText:{color:\"#808888\",padding:8,alignSelf:\"center\",marginLeft:\"0px\"},ackIcons:{fontSize:18,verticalAlign:\"middle\",marginLeft:4},deletedIcon:{fontSize:18,verticalAlign:\"middle\",marginRight:4},ackDoneAllIcon:{color:green[500],fontSize:18,verticalAlign:\"middle\",marginLeft:4},downloadMedia:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\",backgroundColor:\"inherit\",padding:10}}));const reducer=(state,action)=>{if(action.type===\"LOAD_MESSAGES\"){const messages=action.payload;const newMessages=[];messages.forEach(message=>{const messageIndex=state.findIndex(m=>m.id===message.id);if(messageIndex!==-1){state[messageIndex]=message;}else{newMessages.push(message);}});return[...newMessages,...state];}if(action.type===\"ADD_MESSAGE\"){const newMessage=action.payload;const messageIndex=state.findIndex(m=>m.id===newMessage.id);if(messageIndex!==-1){state[messageIndex]=newMessage;}else{state.push(newMessage);}return[...state];}if(action.type===\"UPDATE_MESSAGE\"){const messageToUpdate=action.payload;const messageIndex=state.findIndex(m=>m.id===messageToUpdate.id);if(messageIndex!==-1){state[messageIndex]=messageToUpdate;}return[...state];}if(action.type===\"RESET\"){return[];}};const MessagesList=_ref=>{let{ticketId,isGroup}=_ref;const classes=useStyles();const[messagesList,dispatch]=useReducer(reducer,[]);const[pageNumber,setPageNumber]=useState(1);const[hasMore,setHasMore]=useState(false);const[loading,setLoading]=useState(false);const lastMessageRef=useRef();const[selectedMessage,setSelectedMessage]=useState({});const[anchorEl,setAnchorEl]=useState(null);const messageOptionsMenuOpen=Boolean(anchorEl);const currentTicketId=useRef(ticketId);useEffect(()=>{dispatch({type:\"RESET\"});setPageNumber(1);currentTicketId.current=ticketId;},[ticketId]);useEffect(()=>{setLoading(true);const delayDebounceFn=setTimeout(()=>{const fetchMessages=async()=>{try{const{data}=await api.get(\"/messages/\"+ticketId,{params:{pageNumber}});if(currentTicketId.current===ticketId){dispatch({type:\"LOAD_MESSAGES\",payload:data.messages});setHasMore(data.hasMore);setLoading(false);}if(pageNumber===1&&data.messages.length>1){scrollToBottom();}}catch(err){setLoading(false);toastError(err);}};fetchMessages();},500);return()=>{clearTimeout(delayDebounceFn);};},[pageNumber,ticketId]);useEffect(()=>{const socket=openSocket();socket.on(\"ready\",()=>socket.emit(\"joinChatBox\",ticketId));socket.on(\"appMessage\",data=>{if(data.action===\"create\"){dispatch({type:\"ADD_MESSAGE\",payload:data.message});scrollToBottom();}if(data.action===\"update\"){dispatch({type:\"UPDATE_MESSAGE\",payload:data.message});}});return()=>{socket.disconnect();};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[ticketId]);const loadMore=()=>{setPageNumber(prevPageNumber=>prevPageNumber+1);};const scrollToBottom=()=>{if(lastMessageRef.current){lastMessageRef.current.scrollIntoView({});}};const handleScroll=e=>{if(!hasMore)return;const{scrollTop}=e.currentTarget;if(scrollTop===0){document.getElementById(\"messagesList\").scrollTop=1;}if(loading){return;}if(scrollTop<50){loadMore();}};const handleOpenMessageOptionsMenu=(e,message)=>{setAnchorEl(e.currentTarget);setSelectedMessage(message);};const handleCloseMessageOptionsMenu=e=>{setAnchorEl(null);};const checkMessageMedia=message=>{if(message.mediaType===\"locationMessage\"&&message.body.split('|').length>=2){try{let locationParts=message.body.split('|');let imageLocation=locationParts[0];let linkLocation=locationParts[1];let descriptionLocation=null;if(locationParts.length>2){var _message$body;descriptionLocation=message===null||message===void 0?void 0:(_message$body=message.body)===null||_message$body===void 0?void 0:_message$body.split('|')[2];}return/*#__PURE__*/React.createElement(LocationPreview,{image:imageLocation,link:linkLocation,description:descriptionLocation});}catch(err){console.log(\"checkMessageMedia ~ err\",err);}}else if(message.mediaType===\"contactMessage\"){let array=message.body.split(\"\\n\");let obj=[];let contact=\"\";for(let index=0;index<array.length;index++){const v=array[index];let values=v.split(\":\");for(let ind=0;ind<values.length;ind++){if(values[ind].indexOf(\"+\")!==-1){obj.push({number:values[ind]});}if(values[ind].indexOf(\"FN\")!==-1){contact=values[ind+1];}}}return/*#__PURE__*/React.createElement(VcardPreview,{contact:contact,numbers:obj[0].number});}/*else if (message.mediaType === \"multi_vcard\") {\n     \n      \t\n        if(message.body !== null && message.body !== \"\") {\n          let newBody = JSON.parse(message.body)\n          return (\n            <>\n              {\n              newBody.map(v => (\n                <VcardPreview contact={v.name} numbers={v.number} />\n              ))\n              }\n            </>\n          )\n        } else return (<></>)\n      }*/else if(message.mediaType===\"image\"){return/*#__PURE__*/React.createElement(ModalImageCors,{imageUrl:message.mediaUrl});}else if(message.mediaType===\"audio\"){return/*#__PURE__*/React.createElement(\"audio\",{controls:true},/*#__PURE__*/React.createElement(\"source\",{src:message.mediaUrl,type:\"audio/ogg\"}));}else if(message.mediaType===\"video\"){return/*#__PURE__*/React.createElement(\"video\",{className:classes.messageMedia,src:message.mediaUrl,controls:true});}else{return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:classes.downloadMedia},/*#__PURE__*/React.createElement(Button,{startIcon:/*#__PURE__*/React.createElement(GetApp,null),color:\"primary\",variant:\"outlined\",target:\"_blank\",href:message.mediaUrl},\"Download\")),/*#__PURE__*/React.createElement(Divider,null));}};const renderMessageAck=message=>{if(message.ack===0){return/*#__PURE__*/React.createElement(AccessTime,{fontSize:\"small\",className:classes.ackIcons});}if(message.ack===1){return/*#__PURE__*/React.createElement(Done,{fontSize:\"small\",className:classes.ackIcons});}if(message.ack===2){return/*#__PURE__*/React.createElement(Done,{fontSize:\"small\",className:classes.ackIcons});}if(message.ack===3){return/*#__PURE__*/React.createElement(DoneAll,{fontSize:\"small\",className:classes.ackIcons});}if(message.ack===4||message.ack===5){return/*#__PURE__*/React.createElement(DoneAll,{fontSize:\"small\",className:classes.ackDoneAllIcon});}};const renderDailyTimestamps=(message,index)=>{if(index===0){return/*#__PURE__*/React.createElement(\"span\",{className:classes.dailyTimestamp,key:\"timestamp-\".concat(message.id)},/*#__PURE__*/React.createElement(\"div\",{className:classes.dailyTimestampText},format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")));}if(index<messagesList.length-1){let messageDay=parseISO(messagesList[index].createdAt);let previousMessageDay=parseISO(messagesList[index-1].createdAt);if(!isSameDay(messageDay,previousMessageDay)){return/*#__PURE__*/React.createElement(\"span\",{className:classes.dailyTimestamp,key:\"timestamp-\".concat(message.id)},/*#__PURE__*/React.createElement(\"div\",{className:classes.dailyTimestampText},format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")));}}if(index===messagesList.length-1){return/*#__PURE__*/React.createElement(\"div\",{key:\"ref-\".concat(message.createdAt),ref:lastMessageRef,style:{float:\"left\",clear:\"both\"}});}};const renderMessageDivider=(message,index)=>{if(index<messagesList.length&&index>0){let messageUser=messagesList[index].fromMe;let previousMessageUser=messagesList[index-1].fromMe;if(messageUser!==previousMessageUser){return/*#__PURE__*/React.createElement(\"span\",{style:{marginTop:16},key:\"divider-\".concat(message.id)});}}};const renderNumberTicket=(message,index)=>{if(index<messagesList.length&&index>0){let messageTicket=message.ticketId;let previousMessageTicket=messagesList[index-1].ticketId;if(messageTicket!==previousMessageTicket){return/*#__PURE__*/React.createElement(\"div\",{key:\"ticket-\".concat(message.id),className:classes.ticketNunber},\"#ticket: \",messageTicket,/*#__PURE__*/React.createElement(\"hr\",null));}}};const renderQuotedMessage=message=>{var _message$quotedMsg,_message$quotedMsg2,_message$quotedMsg3,_message$quotedMsg3$c,_message$quotedMsg4;return/*#__PURE__*/React.createElement(\"div\",{className:clsx(classes.quotedContainerLeft,{[classes.quotedContainerRight]:message.fromMe})},/*#__PURE__*/React.createElement(\"span\",{className:clsx(classes.quotedSideColorLeft,{[classes.quotedSideColorRight]:(_message$quotedMsg=message.quotedMsg)===null||_message$quotedMsg===void 0?void 0:_message$quotedMsg.fromMe})}),/*#__PURE__*/React.createElement(\"div\",{className:classes.quotedMsg},!((_message$quotedMsg2=message.quotedMsg)===null||_message$quotedMsg2===void 0?void 0:_message$quotedMsg2.fromMe)&&/*#__PURE__*/React.createElement(\"span\",{className:classes.messageContactName},(_message$quotedMsg3=message.quotedMsg)===null||_message$quotedMsg3===void 0?void 0:(_message$quotedMsg3$c=_message$quotedMsg3.contact)===null||_message$quotedMsg3$c===void 0?void 0:_message$quotedMsg3$c.name),(_message$quotedMsg4=message.quotedMsg)===null||_message$quotedMsg4===void 0?void 0:_message$quotedMsg4.body));};const renderMessages=()=>{if(messagesList.length>0){const viewMessagesList=messagesList.map((message,index)=>{if(message.mediaType===\"call_log\"){var _message$contact;return/*#__PURE__*/React.createElement(React.Fragment,{key:message.id},renderDailyTimestamps(message,index),renderMessageDivider(message,index),renderNumberTicket(message,index),/*#__PURE__*/React.createElement(\"div\",{className:classes.messageCenter},/*#__PURE__*/React.createElement(IconButton,{variant:\"contained\",size:\"small\",id:\"messageActionsButton\",disabled:message.isDeleted,className:classes.messageActionsButton,onClick:e=>handleOpenMessageOptionsMenu(e,message)},/*#__PURE__*/React.createElement(ExpandMore,null)),isGroup&&/*#__PURE__*/React.createElement(\"span\",{className:classes.messageContactName},(_message$contact=message.contact)===null||_message$contact===void 0?void 0:_message$contact.name),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 17\",width:\"20\",height:\"17\"},/*#__PURE__*/React.createElement(\"path\",{fill:\"#df3333\",d:\"M18.2 12.1c-1.5-1.8-5-2.7-8.2-2.7s-6.7 1-8.2 2.7c-.7.8-.3 2.3.2 2.8.2.2.3.3.5.3 1.4 0 3.6-.7 3.6-.7.5-.2.8-.5.8-1v-1.3c.7-1.2 5.4-1.2 6.4-.1l.1.1v1.3c0 .2.1.4.2.6.1.2.3.3.5.4 0 0 2.2.7 3.6.7.2 0 1.4-2 .5-3.1zM5.4 3.2l4.7 4.6 5.8-5.7-.9-.8L10.1 6 6.4 2.3h2.5V1H4.1v4.8h1.3V3.2z\"})),\" \",/*#__PURE__*/React.createElement(\"span\",null,\"Chamada de voz/v\\xEDdeo perdida \\xE0s \",format(parseISO(message.createdAt),\"HH:mm\")))));}if(!message.fromMe){var _message$contact2;return/*#__PURE__*/React.createElement(React.Fragment,{key:message.id},renderDailyTimestamps(message,index),renderMessageDivider(message,index),renderNumberTicket(message,index),/*#__PURE__*/React.createElement(\"div\",{className:classes.messageLeft},/*#__PURE__*/React.createElement(IconButton,{variant:\"contained\",size:\"small\",id:\"messageActionsButton\",disabled:message.isDeleted,className:classes.messageActionsButton,onClick:e=>handleOpenMessageOptionsMenu(e,message)},/*#__PURE__*/React.createElement(ExpandMore,null)),isGroup&&/*#__PURE__*/React.createElement(\"span\",{className:classes.messageContactName},(_message$contact2=message.contact)===null||_message$contact2===void 0?void 0:_message$contact2.name),(message.mediaUrl||message.mediaType===\"contactMessage\"||message.mediaType===\"locationMessage\"//|| message.mediaType === \"multi_vcard\" \n)&&checkMessageMedia(message),/*#__PURE__*/React.createElement(\"div\",{className:classes.textContentItem},message.quotedMsg&&renderQuotedMessage(message),/*#__PURE__*/React.createElement(MarkdownWrapper,null,message.body),/*#__PURE__*/React.createElement(\"span\",{className:classes.timestamp},format(parseISO(message.createdAt),\"HH:mm\")))));}else{return/*#__PURE__*/React.createElement(React.Fragment,{key:message.id},renderDailyTimestamps(message,index),renderMessageDivider(message,index),renderNumberTicket(message,index),/*#__PURE__*/React.createElement(\"div\",{className:classes.messageRight},/*#__PURE__*/React.createElement(IconButton,{variant:\"contained\",size:\"small\",id:\"messageActionsButton\",disabled:message.isDeleted,className:classes.messageActionsButton,onClick:e=>handleOpenMessageOptionsMenu(e,message)},/*#__PURE__*/React.createElement(ExpandMore,null)),(message.mediaUrl||message.mediaType===\"contactMessage\"||message.mediaType===\"locationMessage\"//|| message.mediaType === \"multi_vcard\" \n)&&checkMessageMedia(message),/*#__PURE__*/React.createElement(\"div\",{className:clsx(classes.textContentItem,{[classes.textContentItemDeleted]:message.isDeleted})},message.isDeleted&&/*#__PURE__*/React.createElement(Block,{color:\"disabled\",fontSize:\"small\",className:classes.deletedIcon}),message.quotedMsg&&renderQuotedMessage(message),/*#__PURE__*/React.createElement(MarkdownWrapper,null,message.body),/*#__PURE__*/React.createElement(\"span\",{className:classes.timestamp},format(parseISO(message.createdAt),\"HH:mm\"),renderMessageAck(message)))));}});return viewMessagesList;}else{return/*#__PURE__*/React.createElement(\"div\",null,\"Say hello to your new contact!\");}};return/*#__PURE__*/React.createElement(\"div\",{className:classes.messagesListWrapper},/*#__PURE__*/React.createElement(MessageOptionsMenu,{message:selectedMessage,anchorEl:anchorEl,menuOpen:messageOptionsMenuOpen,handleClose:handleCloseMessageOptionsMenu}),/*#__PURE__*/React.createElement(\"div\",{id:\"messagesList\",className:classes.messagesList,onScroll:handleScroll},messagesList.length>0?renderMessages():[]),loading&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(CircularProgress,{className:classes.circleLoading})));};export default MessagesList;","map":{"version":3,"names":["React","useState","useEffect","useReducer","useRef","isSameDay","parseISO","format","openSocket","clsx","green","Button","CircularProgress","Divider","IconButton","makeStyles","AccessTime","Block","Done","DoneAll","ExpandMore","GetApp","MarkdownWrapper","VcardPreview","LocationPreview","ModalImageCors","MessageOptionsMenu","whatsBackground","api","toastError","useStyles","theme","messagesListWrapper","overflow","position","display","flexDirection","flexGrow","messageCenter","marginTop","alignItems","verticalAlign","alignContent","backgroundColor","fontSize","minWidth","maxWidth","color","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","paddingLeft","paddingRight","paddingTop","paddingBottom","boxShadow","messagesList","backgroundImage","concat","padding","overflowY","breakpoints","down","scrollbarStyles","circleLoading","opacity","top","left","messageLeft","marginRight","height","right","whiteSpace","alignSelf","quotedContainerLeft","margin","borderRadius","quotedMsg","quotedSideColorLeft","flex","width","messageRight","marginLeft","quotedContainerRight","quotedMsgRight","quotedSideColorRight","messageActionsButton","zIndex","messageContactName","fontWeight","textContentItem","overflowWrap","textContentItemDeleted","fontStyle","messageMedia","objectFit","timestamp","bottom","dailyTimestamp","textAlign","dailyTimestampText","ackIcons","deletedIcon","ackDoneAllIcon","downloadMedia","justifyContent","reducer","state","action","type","messages","payload","newMessages","forEach","message","messageIndex","findIndex","m","id","push","newMessage","messageToUpdate","MessagesList","_ref","ticketId","isGroup","classes","dispatch","pageNumber","setPageNumber","hasMore","setHasMore","loading","setLoading","lastMessageRef","selectedMessage","setSelectedMessage","anchorEl","setAnchorEl","messageOptionsMenuOpen","Boolean","currentTicketId","current","delayDebounceFn","setTimeout","fetchMessages","data","get","params","length","scrollToBottom","err","clearTimeout","socket","on","emit","disconnect","loadMore","prevPageNumber","scrollIntoView","handleScroll","e","scrollTop","currentTarget","document","getElementById","handleOpenMessageOptionsMenu","handleCloseMessageOptionsMenu","checkMessageMedia","mediaType","body","split","locationParts","imageLocation","linkLocation","descriptionLocation","_message$body","createElement","image","link","description","console","log","array","obj","contact","index","v","values","ind","indexOf","number","numbers","imageUrl","mediaUrl","controls","src","className","Fragment","startIcon","variant","target","href","renderMessageAck","ack","renderDailyTimestamps","key","createdAt","messageDay","previousMessageDay","ref","style","float","clear","renderMessageDivider","messageUser","fromMe","previousMessageUser","renderNumberTicket","messageTicket","previousMessageTicket","ticketNunber","renderQuotedMessage","_message$quotedMsg","_message$quotedMsg2","_message$quotedMsg3","_message$quotedMsg3$c","_message$quotedMsg4","name","renderMessages","viewMessagesList","map","_message$contact","size","disabled","isDeleted","onClick","xmlns","viewBox","fill","d","_message$contact2","menuOpen","handleClose","onScroll"],"sources":["/home/user/whaticket-free/frontend/src/components/MessagesList/index.js"],"sourcesContent":["import React, { useState, useEffect, useReducer, useRef  } from \"react\";\n\nimport { isSameDay, parseISO, format } from \"date-fns\";\nimport openSocket from \"../../services/socket-io\";\nimport clsx from \"clsx\";\n\nimport { green } from \"@material-ui/core/colors\";\nimport {\n  Button,\n  CircularProgress,\n  Divider,\n  IconButton,\n  makeStyles,\n} from \"@material-ui/core\";\nimport {\n  AccessTime,\n  Block,\n  Done,\n  DoneAll,\n  ExpandMore,\n  GetApp,\n} from \"@material-ui/icons\";\n\nimport MarkdownWrapper from \"../MarkdownWrapper\";\nimport VcardPreview from \"../VcardPreview\";\nimport LocationPreview from \"../LocationPreview\";\nimport ModalImageCors from \"../ModalImageCors\";\nimport MessageOptionsMenu from \"../MessageOptionsMenu\";\nimport whatsBackground from \"../../assets/wa-background.png\";\n\nimport api from \"../../services/api\";\nimport toastError from \"../../errors/toastError\";\n\nconst useStyles = makeStyles((theme) => ({\n  messagesListWrapper: {\n    overflow: \"hidden\",\n    position: \"relative\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: 1,\n  },\n\n  messageCenter: {\n    marginTop: 5,\n    alignItems: \"center\",\n    verticalAlign: \"center\",\n    alignContent: \"center\",\n    backgroundColor: \"#E1F5FEEB\",\n    fontSize: \"12px\",\n    minWidth: 100,\n    maxWidth: 270,\n    color: \"#272727\",\n    borderTopLeftRadius: 0,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n    paddingLeft: 5,\n    paddingRight: 5,\n    paddingTop: 5,\n    paddingBottom: 0,\n    boxShadow: \"0 1px 1px #b3b3b3\",\n  },\n\n  messagesList: {\n    backgroundImage: `url(${whatsBackground})`,\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: 1,\n    padding: \"20px 20px 20px 20px\",\n    overflowY: \"scroll\",\n    [theme.breakpoints.down(\"sm\")]: {\n      paddingBottom: \"90px\",\n    },\n    ...theme.scrollbarStyles,\n  },\n\n  circleLoading: {\n    color: green[500],\n    position: \"absolute\",\n    opacity: \"70%\",\n    top: 0,\n    left: \"50%\",\n    marginTop: 12,\n  },\n\n  messageLeft: {\n    marginRight: 20,\n    marginTop: 2,\n    minWidth: 100,\n    maxWidth: 600,\n    height: \"auto\",\n    display: \"block\",\n    position: \"relative\",\n    \"&:hover #messageActionsButton\": {\n      display: \"flex\",\n      position: \"absolute\",\n      top: 0,\n      right: 0,\n    },\n\n    whiteSpace: \"pre-wrap\",\n    backgroundColor: \"#ffffff\",\n    color: \"#303030\",\n    alignSelf: \"flex-start\",\n    borderTopLeftRadius: 0,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n    paddingLeft: 5,\n    paddingRight: 5,\n    paddingTop: 5,\n    paddingBottom: 0,\n    boxShadow: \"0 1px 1px #b3b3b3\",\n  },\n\n  quotedContainerLeft: {\n    margin: \"-3px -80px 6px -6px\",\n    overflow: \"hidden\",\n    backgroundColor: \"#f0f0f0\",\n    borderRadius: \"7.5px\",\n    display: \"flex\",\n    position: \"relative\",\n  },\n\n  quotedMsg: {\n    padding: 10,\n    maxWidth: 300,\n    height: \"auto\",\n    display: \"block\",\n    whiteSpace: \"pre-wrap\",\n    overflow: \"hidden\",\n  },\n\n  quotedSideColorLeft: {\n    flex: \"none\",\n    width: \"4px\",\n    backgroundColor: \"#6bcbef\",\n  },\n\n  messageRight: {\n    marginLeft: 20,\n    marginTop: 2,\n    minWidth: 100,\n    maxWidth: 600,\n    height: \"auto\",\n    display: \"block\",\n    position: \"relative\",\n    \"&:hover #messageActionsButton\": {\n      display: \"flex\",\n      position: \"absolute\",\n      top: 0,\n      right: 0,\n    },\n\n    whiteSpace: \"pre-wrap\",\n    backgroundColor: \"#dcf8c6\",\n    color: \"#303030\",\n    alignSelf: \"flex-end\",\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 0,\n    paddingLeft: 5,\n    paddingRight: 5,\n    paddingTop: 5,\n    paddingBottom: 0,\n    boxShadow: \"0 1px 1px #b3b3b3\",\n  },\n\n  quotedContainerRight: {\n    margin: \"-3px -80px 6px -6px\",\n    overflowY: \"hidden\",\n    backgroundColor: \"#cfe9ba\",\n    borderRadius: \"7.5px\",\n    display: \"flex\",\n    position: \"relative\",\n  },\n\n  quotedMsgRight: {\n    padding: 10,\n    maxWidth: 300,\n    height: \"auto\",\n    whiteSpace: \"pre-wrap\",\n  },\n\n  quotedSideColorRight: {\n    flex: \"none\",\n    width: \"4px\",\n    backgroundColor: \"#35cd96\",\n  },\n\n  messageActionsButton: {\n    display: \"none\",\n    position: \"relative\",\n    color: \"#999\",\n    zIndex: 1,\n    backgroundColor: \"inherit\",\n    opacity: \"90%\",\n    \"&:hover, &.Mui-focusVisible\": { backgroundColor: \"inherit\" },\n  },\n\n  messageContactName: {\n    display: \"flex\",\n    color: \"#6bcbef\",\n    fontWeight: 500,\n  },\n\n  textContentItem: {\n    overflowWrap: \"break-word\",\n    padding: \"3px 80px 6px 6px\",\n  },\n\n  textContentItemDeleted: {\n    fontStyle: \"italic\",\n    color: \"rgba(0, 0, 0, 0.36)\",\n    overflowWrap: \"break-word\",\n    padding: \"3px 80px 6px 6px\",\n  },\n\n  messageMedia: {\n    objectFit: \"cover\",\n    width: 250,\n    height: 200,\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n  },\n\n  timestamp: {\n    fontSize: 11,\n    position: \"absolute\",\n    bottom: 0,\n    right: 5,\n    color: \"#999\",\n  },\n\n  dailyTimestamp: {\n    alignItems: \"center\",\n    textAlign: \"center\",\n    alignSelf: \"center\",\n    width: \"110px\",\n    backgroundColor: \"#e1f3fb\",\n    margin: \"10px\",\n    borderRadius: \"10px\",\n    boxShadow: \"0 1px 1px #b3b3b3\",\n  },\n\n  dailyTimestampText: {\n    color: \"#808888\",\n    padding: 8,\n    alignSelf: \"center\",\n    marginLeft: \"0px\",\n  },\n\n  ackIcons: {\n    fontSize: 18,\n    verticalAlign: \"middle\",\n    marginLeft: 4,\n  },\n\n  deletedIcon: {\n    fontSize: 18,\n    verticalAlign: \"middle\",\n    marginRight: 4,\n  },\n\n  ackDoneAllIcon: {\n    color: green[500],\n    fontSize: 18,\n    verticalAlign: \"middle\",\n    marginLeft: 4,\n  },\n\n  downloadMedia: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    backgroundColor: \"inherit\",\n    padding: 10,\n  },\n}));\n\nconst reducer = (state, action) => {\n  if (action.type === \"LOAD_MESSAGES\") {\n    const messages = action.payload;\n    const newMessages = [];\n\n    messages.forEach((message) => {\n      const messageIndex = state.findIndex((m) => m.id === message.id);\n      if (messageIndex !== -1) {\n        state[messageIndex] = message;\n      } else {\n        newMessages.push(message);\n      }\n    });\n\n    return [...newMessages, ...state];\n  }\n\n  if (action.type === \"ADD_MESSAGE\") {\n    const newMessage = action.payload;\n    const messageIndex = state.findIndex((m) => m.id === newMessage.id);\n\n    if (messageIndex !== -1) {\n      state[messageIndex] = newMessage;\n    } else {\n      state.push(newMessage);\n    }\n\n    return [...state];\n  }\n\n  if (action.type === \"UPDATE_MESSAGE\") {\n    const messageToUpdate = action.payload;\n    const messageIndex = state.findIndex((m) => m.id === messageToUpdate.id);\n\n    if (messageIndex !== -1) {\n      state[messageIndex] = messageToUpdate;\n    }\n\n    return [...state];\n  }\n\n  if (action.type === \"RESET\") {\n    return [];\n  }\n};\n\nconst MessagesList = ({ ticketId, isGroup }) => {\n  const classes = useStyles();\n\n  const [messagesList, dispatch] = useReducer(reducer, []);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [hasMore, setHasMore] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const lastMessageRef = useRef();\n\n  const [selectedMessage, setSelectedMessage] = useState({});\n  const [anchorEl, setAnchorEl] = useState(null);\n  const messageOptionsMenuOpen = Boolean(anchorEl);\n  const currentTicketId = useRef(ticketId);\n\n  useEffect(() => {\n    dispatch({ type: \"RESET\" });\n    setPageNumber(1);\n\n    currentTicketId.current = ticketId;\n  }, [ticketId]);\n\n  useEffect(() => {\n    setLoading(true);\n    const delayDebounceFn = setTimeout(() => {\n      const fetchMessages = async () => {\n        try {\n          const { data } = await api.get(\"/messages/\" + ticketId, {\n            params: { pageNumber },\n          });\n\n          if (currentTicketId.current === ticketId) {\n            dispatch({ type: \"LOAD_MESSAGES\", payload: data.messages });\n            setHasMore(data.hasMore);\n            setLoading(false);\n          }\n\n          if (pageNumber === 1 && data.messages.length > 1) {\n            scrollToBottom();\n          }\n        } catch (err) {\n          setLoading(false);\n          toastError(err);\n        }\n      };\n      fetchMessages();\n    }, 500);\n    return () => {\n      clearTimeout(delayDebounceFn);\n    };\n  }, [pageNumber, ticketId]);\n\n  useEffect(() => {\n    const socket = openSocket();\n\n    socket.on(\"ready\", () => socket.emit(\"joinChatBox\", ticketId));\n\n    socket.on(\"appMessage\", (data) => {\n      if (data.action === \"create\") {\n        dispatch({ type: \"ADD_MESSAGE\", payload: data.message });\n        scrollToBottom();\n      }\n\n      if (data.action === \"update\") {\n        dispatch({ type: \"UPDATE_MESSAGE\", payload: data.message });\n      }\n    });\n\n    return () => {\n      socket.disconnect();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ticketId]);\n\n  const loadMore = () => {\n    setPageNumber((prevPageNumber) => prevPageNumber + 1);\n  };\n\n  const scrollToBottom = () => {\n    if (lastMessageRef.current) {\n      lastMessageRef.current.scrollIntoView({});\n    }\n  };\n\n  const handleScroll = (e) => {\n    if (!hasMore) return;\n    const { scrollTop } = e.currentTarget;\n\n    if (scrollTop === 0) {\n      document.getElementById(\"messagesList\").scrollTop = 1;\n    }\n\n    if (loading) {\n      return;\n    }\n\n    if (scrollTop < 50) {\n      loadMore();\n    }\n  };\n\n  const handleOpenMessageOptionsMenu = (e, message) => {\n    setAnchorEl(e.currentTarget);\n    setSelectedMessage(message);\n  };\n\n  const handleCloseMessageOptionsMenu = (e) => {\n    setAnchorEl(null);\n  };\n\n  const checkMessageMedia = (message) => {\n\n    if (message.mediaType === \"locationMessage\" && message.body.split('|').length >= 2) {\n      try {\n        let locationParts = message.body.split('|')\n        let imageLocation = locationParts[0]\n        let linkLocation = locationParts[1]\n\n        let descriptionLocation = null\n\n        if (locationParts.length > 2) {\n          descriptionLocation = message?.body?.split('|')[2]\n        }\n        return <LocationPreview image={imageLocation} link={linkLocation} description={descriptionLocation} />\n      } catch (err) {\n        console.log(\"checkMessageMedia ~ err\", err)\n\n      }\n    } else\n      if (message.mediaType === \"contactMessage\") {\n        let array = message.body.split(\"\\n\");\n        let obj = [];\n        let contact = \"\";\n        for (let index = 0; index < array.length; index++) {\n          const v = array[index];\n          let values = v.split(\":\");\n          for (let ind = 0; ind < values.length; ind++) {\n            if (values[ind].indexOf(\"+\") !== -1) {\n              obj.push({ number: values[ind] });\n            }\n            if (values[ind].indexOf(\"FN\") !== -1) {\n              contact = values[ind + 1];\n            }\n          }\n        }\n        return <VcardPreview contact={contact} numbers={obj[0].number} />\n      }\n      /*else if (message.mediaType === \"multi_vcard\") {\n     \n      \t\n        if(message.body !== null && message.body !== \"\") {\n          let newBody = JSON.parse(message.body)\n          return (\n            <>\n              {\n              newBody.map(v => (\n                <VcardPreview contact={v.name} numbers={v.number} />\n              ))\n              }\n            </>\n          )\n        } else return (<></>)\n      }*/\n      else if (message.mediaType === \"image\") {\n\n        return <ModalImageCors imageUrl={message.mediaUrl} />;\n      } else if (message.mediaType === \"audio\") {\n        return (\n          <audio controls>\n            <source src={message.mediaUrl} type=\"audio/ogg\"></source>\n          </audio>\n        );\n      } else if (message.mediaType === \"video\") {\n\n        return (\n          <video\n            className={classes.messageMedia}\n            src={message.mediaUrl}\n            controls\n          />\n        );\n      } else {\n\n        return (\n          <>\n            <div className={classes.downloadMedia}>\n              <Button\n                startIcon={<GetApp />}\n                color=\"primary\"\n                variant=\"outlined\"\n                target=\"_blank\"\n                href={message.mediaUrl}\n              >\n                Download\n              </Button>\n            </div>\n            <Divider />\n          </>\n        );\n      }\n  };\n\n  const renderMessageAck = (message) => {\n    if (message.ack === 0) {\n      return <AccessTime fontSize=\"small\" className={classes.ackIcons} />;\n    }\n    if (message.ack === 1) {\n      return <Done fontSize=\"small\" className={classes.ackIcons} />;\n    }\n    if (message.ack === 2) {\n      return <Done fontSize=\"small\" className={classes.ackIcons} />;\n    }\n    if (message.ack === 3) {\n      return <DoneAll fontSize=\"small\" className={classes.ackIcons} />;\n    }\n    if (message.ack === 4 || message.ack === 5) {\n      return <DoneAll fontSize=\"small\" className={classes.ackDoneAllIcon} />;\n    }\n  };\n\n  const renderDailyTimestamps = (message, index) => {\n    if (index === 0) {\n      return (\n        <span\n          className={classes.dailyTimestamp}\n          key={`timestamp-${message.id}`}\n        >\n          <div className={classes.dailyTimestampText}>\n            {format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")}\n          </div>\n        </span>\n      );\n    }\n    if (index < messagesList.length - 1) {\n      let messageDay = parseISO(messagesList[index].createdAt);\n      let previousMessageDay = parseISO(messagesList[index - 1].createdAt);\n\n      if (!isSameDay(messageDay, previousMessageDay)) {\n        return (\n          <span\n            className={classes.dailyTimestamp}\n            key={`timestamp-${message.id}`}\n          >\n            <div className={classes.dailyTimestampText}>\n              {format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")}\n            </div>\n          </span>\n        );\n      }\n    }\n    if (index === messagesList.length - 1) {\n      return (\n        <div\n          key={`ref-${message.createdAt}`}\n          ref={lastMessageRef}\n          style={{ float: \"left\", clear: \"both\" }}\n        />\n      );\n    }\n  };\n\n  const renderMessageDivider = (message, index) => {\n    if (index < messagesList.length && index > 0) {\n      let messageUser = messagesList[index].fromMe;\n      let previousMessageUser = messagesList[index - 1].fromMe;\n\n      if (messageUser !== previousMessageUser) {\n        return (\n          <span style={{ marginTop: 16 }} key={`divider-${message.id}`}></span>\n        );\n      }\n    }\n  };\n\n  const renderNumberTicket = (message, index) => {\n    if (index < messagesList.length && index > 0) {\n      let messageTicket = message.ticketId;\n      let previousMessageTicket = messagesList[index - 1].ticketId;\n      if (messageTicket !== previousMessageTicket) {\n        return (\n          <div key={`ticket-${message.id}`} className={classes.ticketNunber}>\n            #ticket: {messageTicket}\n            <hr />\n          </div>\n        );\n      }\n    }\n  };\n\n  const renderQuotedMessage = (message) => {\n    return (\n      <div\n        className={clsx(classes.quotedContainerLeft, {\n          [classes.quotedContainerRight]: message.fromMe,\n        })}\n      >\n        <span\n          className={clsx(classes.quotedSideColorLeft, {\n            [classes.quotedSideColorRight]: message.quotedMsg?.fromMe,\n          })}\n        ></span>\n        <div className={classes.quotedMsg}>\n          {!message.quotedMsg?.fromMe && (\n            <span className={classes.messageContactName}>\n              {message.quotedMsg?.contact?.name}\n            </span>\n          )}\n          {message.quotedMsg?.body}\n        </div>\n      </div>\n    );\n  };\n\n  const renderMessages = () => {\n    if (messagesList.length > 0) {\n      const viewMessagesList = messagesList.map((message, index) => {\n        if (message.mediaType === \"call_log\") {\n          return (\n            <React.Fragment key={message.id}>\n              {renderDailyTimestamps(message, index)}\n              {renderMessageDivider(message, index)}\n              {renderNumberTicket(message, index)}\n              <div className={classes.messageCenter}>\n                <IconButton\n                  variant=\"contained\"\n                  size=\"small\"\n                  id=\"messageActionsButton\"\n                  disabled={message.isDeleted}\n                  className={classes.messageActionsButton}\n                  onClick={(e) => handleOpenMessageOptionsMenu(e, message)}\n                >\n                  <ExpandMore />\n                </IconButton>\n                {isGroup && (\n                  <span className={classes.messageContactName}>\n                    {message.contact?.name}\n                  </span>\n                )}\n                <div>\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 17\" width=\"20\" height=\"17\">\n                    <path fill=\"#df3333\" d=\"M18.2 12.1c-1.5-1.8-5-2.7-8.2-2.7s-6.7 1-8.2 2.7c-.7.8-.3 2.3.2 2.8.2.2.3.3.5.3 1.4 0 3.6-.7 3.6-.7.5-.2.8-.5.8-1v-1.3c.7-1.2 5.4-1.2 6.4-.1l.1.1v1.3c0 .2.1.4.2.6.1.2.3.3.5.4 0 0 2.2.7 3.6.7.2 0 1.4-2 .5-3.1zM5.4 3.2l4.7 4.6 5.8-5.7-.9-.8L10.1 6 6.4 2.3h2.5V1H4.1v4.8h1.3V3.2z\"></path>\n                  </svg> <span>Chamada de voz/vídeo perdida às {format(parseISO(message.createdAt), \"HH:mm\")}</span>\n                </div>\n              </div>\n            </React.Fragment>\n          );\n        }\n        if (!message.fromMe) {\n          return (\n            <React.Fragment key={message.id}>\n              {renderDailyTimestamps(message, index)}\n              {renderMessageDivider(message, index)}\n              {renderNumberTicket(message, index)}\n              <div className={classes.messageLeft}>\n                <IconButton\n                  variant=\"contained\"\n                  size=\"small\"\n                  id=\"messageActionsButton\"\n                  disabled={message.isDeleted}\n                  className={classes.messageActionsButton}\n                  onClick={(e) => handleOpenMessageOptionsMenu(e, message)}\n                >\n                  <ExpandMore />\n                </IconButton>\n                {isGroup && (\n                  <span className={classes.messageContactName}>\n                    {message.contact?.name}\n                  </span>\n                )}\n                {(message.mediaUrl || message.mediaType === \"contactMessage\" || message.mediaType === \"locationMessage\"\n                  //|| message.mediaType === \"multi_vcard\" \n                ) && checkMessageMedia(message)}\n                \n                <div className={classes.textContentItem}>\n                  {message.quotedMsg && renderQuotedMessage(message)}\n                  <MarkdownWrapper>{message.body}</MarkdownWrapper>\n                  <span className={classes.timestamp}>\n                    {format(parseISO(message.createdAt), \"HH:mm\")}\n                  </span>\n                </div>\n              </div>\n            </React.Fragment>\n          );\n        } else {\n          return (\n            <React.Fragment key={message.id}>\n              {renderDailyTimestamps(message, index)}\n              {renderMessageDivider(message, index)}\n              {renderNumberTicket(message, index)}\n              <div className={classes.messageRight}>\n                <IconButton\n                  variant=\"contained\"\n                  size=\"small\"\n                  id=\"messageActionsButton\"\n                  disabled={message.isDeleted}\n                  className={classes.messageActionsButton}\n                  onClick={(e) => handleOpenMessageOptionsMenu(e, message)}\n                >\n                  <ExpandMore />\n                </IconButton>\n                {(message.mediaUrl || message.mediaType === \"contactMessage\" || message.mediaType === \"locationMessage\"\n                  //|| message.mediaType === \"multi_vcard\" \n                ) && checkMessageMedia(message)}\n                <div\n                  className={clsx(classes.textContentItem, {\n                    [classes.textContentItemDeleted]: message.isDeleted,\n                  })}\n                >\n                  {message.isDeleted && (\n                    <Block\n                      color=\"disabled\"\n                      fontSize=\"small\"\n                      className={classes.deletedIcon}\n                    />\n                  )}\n                  {message.quotedMsg && renderQuotedMessage(message)}\n                  <MarkdownWrapper>{message.body}</MarkdownWrapper>\n                  <span className={classes.timestamp}>\n                    {format(parseISO(message.createdAt), \"HH:mm\")}\n                    {renderMessageAck(message)}\n                  </span>\n                </div>\n              </div>\n            </React.Fragment>\n          );\n        }\n      });\n      return viewMessagesList;\n    } else {\n      return <div>Say hello to your new contact!</div>;\n    }\n  };\n\n  return (\n    <div className={classes.messagesListWrapper}>\n      <MessageOptionsMenu\n        message={selectedMessage}\n        anchorEl={anchorEl}\n        menuOpen={messageOptionsMenuOpen}\n        handleClose={handleCloseMessageOptionsMenu}\n      />\n      <div\n        id=\"messagesList\"\n        className={classes.messagesList}\n        onScroll={handleScroll}\n      >\n        {messagesList.length > 0 ? renderMessages() : []}\n      </div>\n      {loading && (\n        <div>\n          <CircularProgress className={classes.circleLoading} />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default MessagesList;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}