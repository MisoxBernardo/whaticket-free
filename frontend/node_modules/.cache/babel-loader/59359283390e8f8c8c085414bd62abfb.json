{"ast":null,"code":"import{useState,useEffect,useReducer}from\"react\";import openSocket from\"../../services/socket-io\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";const reducer=(state,action)=>{if(action.type===\"LOAD_WHATSAPPS\"){const whatsApps=action.payload;return[...whatsApps];}if(action.type===\"UPDATE_WHATSAPPS\"){const whatsApp=action.payload;const whatsAppIndex=state.findIndex(s=>s.id===whatsApp.id);if(whatsAppIndex!==-1){state[whatsAppIndex]=whatsApp;return[...state];}else{return[whatsApp,...state];}}if(action.type===\"UPDATE_SESSION\"){const whatsApp=action.payload;const whatsAppIndex=state.findIndex(s=>s.id===whatsApp.id);if(whatsAppIndex!==-1){state[whatsAppIndex].status=whatsApp.status;state[whatsAppIndex].updatedAt=whatsApp.updatedAt;state[whatsAppIndex].qrcode=whatsApp.qrcode;state[whatsAppIndex].retries=whatsApp.retries;return[...state];}else{return[...state];}}if(action.type===\"DELETE_WHATSAPPS\"){const whatsAppId=action.payload;const whatsAppIndex=state.findIndex(s=>s.id===whatsAppId);if(whatsAppIndex!==-1){state.splice(whatsAppIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}};const useWhatsApps=()=>{const[whatsApps,dispatch]=useReducer(reducer,[]);const[loading,setLoading]=useState(true);useEffect(()=>{setLoading(true);const fetchSession=async()=>{try{const{data}=await api.get(\"/whatsapp/\");dispatch({type:\"LOAD_WHATSAPPS\",payload:data});setLoading(false);}catch(err){setLoading(false);toastError(err);}};fetchSession();},[]);useEffect(()=>{const socket=openSocket();socket.on(\"whatsapp\",data=>{if(data.action===\"update\"){dispatch({type:\"UPDATE_WHATSAPPS\",payload:data.whatsapp});}});socket.on(\"whatsapp\",data=>{if(data.action===\"delete\"){dispatch({type:\"DELETE_WHATSAPPS\",payload:data.whatsappId});}});socket.on(\"whatsappSession\",data=>{if(data.action===\"update\"){dispatch({type:\"UPDATE_SESSION\",payload:data.session});}});return()=>{socket.disconnect();};},[]);return{whatsApps,loading};};export default useWhatsApps;","map":{"version":3,"names":["useState","useEffect","useReducer","openSocket","toastError","api","reducer","state","action","type","whatsApps","payload","whatsApp","whatsAppIndex","findIndex","s","id","status","updatedAt","qrcode","retries","whatsAppId","splice","useWhatsApps","dispatch","loading","setLoading","fetchSession","data","get","err","socket","on","whatsapp","whatsappId","session","disconnect"],"sources":["/home/user/whaticket-free/frontend/src/hooks/useWhatsApps/index.js"],"sourcesContent":["import { useState, useEffect, useReducer } from \"react\";\nimport openSocket from \"../../services/socket-io\";\nimport toastError from \"../../errors/toastError\";\n\nimport api from \"../../services/api\";\n\nconst reducer = (state, action) => {\n\tif (action.type === \"LOAD_WHATSAPPS\") {\n\t\tconst whatsApps = action.payload;\n\n\t\treturn [...whatsApps];\n\t}\n\n\tif (action.type === \"UPDATE_WHATSAPPS\") {\n\t\tconst whatsApp = action.payload;\n\t\tconst whatsAppIndex = state.findIndex(s => s.id === whatsApp.id);\n\n\t\tif (whatsAppIndex !== -1) {\n\t\t\tstate[whatsAppIndex] = whatsApp;\n\t\t\treturn [...state];\n\t\t} else {\n\t\t\treturn [whatsApp, ...state];\n\t\t}\n\t}\n\n\tif (action.type === \"UPDATE_SESSION\") {\n\t\tconst whatsApp = action.payload;\n\t\tconst whatsAppIndex = state.findIndex(s => s.id === whatsApp.id);\n\n\t\tif (whatsAppIndex !== -1) {\n\t\t\tstate[whatsAppIndex].status = whatsApp.status;\n\t\t\tstate[whatsAppIndex].updatedAt = whatsApp.updatedAt;\n\t\t\tstate[whatsAppIndex].qrcode = whatsApp.qrcode;\n\t\t\tstate[whatsAppIndex].retries = whatsApp.retries;\n\t\t\treturn [...state];\n\t\t} else {\n\t\t\treturn [...state];\n\t\t}\n\t}\n\n\tif (action.type === \"DELETE_WHATSAPPS\") {\n\t\tconst whatsAppId = action.payload;\n\n\t\tconst whatsAppIndex = state.findIndex(s => s.id === whatsAppId);\n\t\tif (whatsAppIndex !== -1) {\n\t\t\tstate.splice(whatsAppIndex, 1);\n\t\t}\n\t\treturn [...state];\n\t}\n\n\tif (action.type === \"RESET\") {\n\t\treturn [];\n\t}\n};\n\nconst useWhatsApps = () => {\n\tconst [whatsApps, dispatch] = useReducer(reducer, []);\n\tconst [loading, setLoading] = useState(true);\n\n\tuseEffect(() => {\n\t\tsetLoading(true);\n\t\tconst fetchSession = async () => {\n\t\t\ttry {\n\t\t\t\tconst { data } = await api.get(\"/whatsapp/\");\n\t\t\t\tdispatch({ type: \"LOAD_WHATSAPPS\", payload: data });\n\t\t\t\tsetLoading(false);\n\t\t\t} catch (err) {\n\t\t\t\tsetLoading(false);\n\t\t\t\ttoastError(err);\n\t\t\t}\n\t\t};\n\t\tfetchSession();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tconst socket = openSocket();\n\n\t\tsocket.on(\"whatsapp\", data => {\n\t\t\tif (data.action === \"update\") {\n\t\t\t\tdispatch({ type: \"UPDATE_WHATSAPPS\", payload: data.whatsapp });\n\t\t\t}\n\t\t});\n\n\t\tsocket.on(\"whatsapp\", data => {\n\t\t\tif (data.action === \"delete\") {\n\t\t\t\tdispatch({ type: \"DELETE_WHATSAPPS\", payload: data.whatsappId });\n\t\t\t}\n\t\t});\n\n\t\tsocket.on(\"whatsappSession\", data => {\n\t\t\tif (data.action === \"update\") {\n\t\t\t\tdispatch({ type: \"UPDATE_SESSION\", payload: data.session });\n\t\t\t}\n\t\t});\n\n\t\treturn () => {\n\t\t\tsocket.disconnect();\n\t\t};\n\t}, []);\n\n\treturn { whatsApps, loading };\n};\n\nexport default useWhatsApps;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}