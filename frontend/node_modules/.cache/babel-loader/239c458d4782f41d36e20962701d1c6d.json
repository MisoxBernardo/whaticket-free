{"ast":null,"code":"import{Chip,Paper,TextField}from\"@material-ui/core\";import Autocomplete from\"@material-ui/lab/Autocomplete\";import React,{useEffect,useState}from\"react\";import{isArray,isString}from\"lodash\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";export function TagsContainer(_ref){let{ticket}=_ref;const[tags,setTags]=useState([]);const[selecteds,setSelecteds]=useState([]);useEffect(()=>{if(ticket){async function fetchData(){await loadTags();if(Array.isArray(ticket.tags)){setSelecteds(ticket.tags);}}fetchData();}},[ticket]);const createTag=async data=>{try{const{data:responseData}=await api.post(\"/tags\",data);return responseData;}catch(err){toastError(err);}};const loadTags=async()=>{try{const{data}=await api.get(\"/tags/list\");setTags(data);}catch(err){toastError(err);}};const syncTags=async data=>{try{const{data:responseData}=await api.post(\"/tags/sync\",data);return responseData;}catch(err){toastError(err);}};const onChange=async(value,reason)=>{let optionsChanged=[];if(reason==='create-option'){if(isArray(value)){for(let item of value){if(isString(item)){const newTag=await createTag({name:item});optionsChanged.push(newTag);}else{optionsChanged.push(item);}}}await loadTags();}else{optionsChanged=value;}setSelecteds(optionsChanged);await syncTags({ticketId:ticket.id,tags:optionsChanged});};return/*#__PURE__*/React.createElement(Paper,{style:{padding:12}},/*#__PURE__*/React.createElement(Autocomplete,{multiple:true,size:\"small\",options:tags,value:selecteds,freeSolo:true,onChange:(e,v,r)=>onChange(v,r),getOptionLabel:option=>option.name,renderTags:(value,getTagProps)=>value.map((option,index)=>/*#__PURE__*/React.createElement(Chip,Object.assign({variant:\"outlined\",style:{backgroundColor:option.color||'#eee',textShadow:'1px 1px 1px #000',color:'white'},label:option.name},getTagProps({index}),{size:\"small\"}))),renderInput:params=>/*#__PURE__*/React.createElement(TextField,Object.assign({},params,{variant:\"outlined\",placeholder:\"Tags\"})),PaperComponent:_ref2=>{let{children}=_ref2;return/*#__PURE__*/React.createElement(Paper,{style:{width:400,marginLeft:12}},children);}}));}","map":{"version":3,"names":["Chip","Paper","TextField","Autocomplete","React","useEffect","useState","isArray","isString","toastError","api","TagsContainer","_ref","ticket","tags","setTags","selecteds","setSelecteds","fetchData","loadTags","Array","createTag","data","responseData","post","err","get","syncTags","onChange","value","reason","optionsChanged","item","newTag","name","push","ticketId","id","createElement","style","padding","multiple","size","options","freeSolo","e","v","r","getOptionLabel","option","renderTags","getTagProps","map","index","Object","assign","variant","backgroundColor","color","textShadow","label","renderInput","params","placeholder","PaperComponent","_ref2","children","width","marginLeft"],"sources":["/home/fenix/whaticket-free/frontend/src/components/TagsContainer/index.js"],"sourcesContent":["import { Chip, Paper, TextField } from \"@material-ui/core\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport React, { useEffect, useState } from \"react\";\nimport { isArray, isString } from \"lodash\";\nimport toastError from \"../../errors/toastError\";\nimport api from \"../../services/api\";\n\nexport function TagsContainer ({ ticket }) {\n\n    const [tags, setTags] = useState([]);\n    const [selecteds, setSelecteds] = useState([]);\n\n    useEffect(() => {\n        if (ticket) {\n            async function fetchData () {\n                await loadTags();\n                if (Array.isArray(ticket.tags)) {\n                    setSelecteds(ticket.tags);\n                }\n            }\n            fetchData();\n        }\n    }, [ticket]);\n\n    const createTag = async (data) => {\n        try {\n            const { data: responseData } = await api.post(`/tags`, data);\n            return responseData;\n        } catch (err) {\n            toastError(err);\n        }\n    }\n\n    const loadTags = async () => {\n        try {\n            const { data } = await api.get(`/tags/list`);\n            setTags(data);\n        } catch (err) {\n            toastError(err);\n        }\n    }\n\n    const syncTags = async (data) => {\n        try {\n            const { data: responseData } = await api.post(`/tags/sync`, data);\n            return responseData;\n        } catch (err) {\n            toastError(err);\n        }\n    }\n\n    const onChange = async (value, reason) => {\n        let optionsChanged = []\n        if (reason === 'create-option') {\n            if (isArray(value)) {\n                for (let item of value) {\n                    if (isString(item)) {\n                        const newTag = await createTag({ name: item })\n                        optionsChanged.push(newTag);\n                    } else {\n                        optionsChanged.push(item);\n                    }\n                }\n            }\n            await loadTags();\n        } else {\n            optionsChanged = value;\n        }\n        setSelecteds(optionsChanged);\n        await syncTags({ ticketId: ticket.id, tags: optionsChanged });\n    }\n\n    return (\n        <Paper style={{padding: 12}}>\n            <Autocomplete\n                multiple\n                size=\"small\"\n                options={tags}\n                value={selecteds}\n                freeSolo\n                onChange={(e, v, r) => onChange(v, r)}\n                getOptionLabel={(option) => option.name}\n                renderTags={(value, getTagProps) =>\n                    value.map((option, index) => (\n                        <Chip\n                            variant=\"outlined\"\n                            style={{backgroundColor: option.color || '#eee', textShadow: '1px 1px 1px #000', color: 'white'}}\n                            label={option.name}\n                            {...getTagProps({ index })}\n                            size=\"small\"\n                        />\n                    ))\n                }\n                renderInput={(params) => (\n                    <TextField {...params} variant=\"outlined\" placeholder=\"Tags\" />\n                )}\n                PaperComponent={({ children }) => (\n                    <Paper style={{width: 400, marginLeft: 12}}>\n                        {children}\n                    </Paper>\n                )}\n            />\n        </Paper>\n    )\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}