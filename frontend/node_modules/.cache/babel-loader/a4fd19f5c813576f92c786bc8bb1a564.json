{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import QRCode from\"qrcode.react\";import openSocket from\"../../services/socket-io\";import toastError from\"../../errors/toastError\";import{Dialog,DialogContent,Paper,Typography}from\"@material-ui/core\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";const QrcodeModal=_ref=>{let{open,onClose,whatsAppId}=_ref;const[qrCode,setQrCode]=useState(\"\");useEffect(()=>{const fetchSession=async()=>{if(!whatsAppId)return;try{const{data}=await api.get(\"/whatsapp/\".concat(whatsAppId));setQrCode(data.qrcode);}catch(err){toastError(err);}};fetchSession();},[whatsAppId]);useEffect(()=>{if(!whatsAppId)return;const socket=openSocket();socket.on(\"whatsappSession\",data=>{if(data.action===\"update\"&&data.session.id===whatsAppId){setQrCode(data.session.qrcode);}if(data.action===\"update\"&&data.session.qrcode===\"\"){onClose();}});return()=>{socket.disconnect();};},[whatsAppId,onClose]);return/*#__PURE__*/React.createElement(Dialog,{open:open,onClose:onClose,maxWidth:\"lg\",scroll:\"paper\"},/*#__PURE__*/React.createElement(DialogContent,null,/*#__PURE__*/React.createElement(Paper,{elevation:0},/*#__PURE__*/React.createElement(Typography,{color:\"primary\",gutterBottom:true},i18n.t(\"qrCode.message\")),qrCode?/*#__PURE__*/React.createElement(QRCode,{value:qrCode,size:256}):/*#__PURE__*/React.createElement(\"span\",null,\"Waiting for QR Code\"))));};export default React.memo(QrcodeModal);","map":{"version":3,"names":["React","useEffect","useState","QRCode","openSocket","toastError","Dialog","DialogContent","Paper","Typography","i18n","api","QrcodeModal","_ref","open","onClose","whatsAppId","qrCode","setQrCode","fetchSession","data","get","concat","qrcode","err","socket","on","action","session","id","disconnect","createElement","maxWidth","scroll","elevation","color","gutterBottom","t","value","size","memo"],"sources":["/home/fenix/whaticket-free/frontend/src/components/QrcodeModal/index.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport QRCode from \"qrcode.react\";\nimport openSocket from \"../../services/socket-io\";\nimport toastError from \"../../errors/toastError\";\n\nimport { Dialog, DialogContent, Paper, Typography } from \"@material-ui/core\";\nimport { i18n } from \"../../translate/i18n\";\nimport api from \"../../services/api\";\n\nconst QrcodeModal = ({ open, onClose, whatsAppId }) => {\n\tconst [qrCode, setQrCode] = useState(\"\");\n\n\tuseEffect(() => {\n\t\tconst fetchSession = async () => {\n\t\t\tif (!whatsAppId) return;\n\n\t\t\ttry {\n\t\t\t\tconst { data } = await api.get(`/whatsapp/${whatsAppId}`);\n\t\t\t\tsetQrCode(data.qrcode);\n\t\t\t} catch (err) {\n\t\t\t\ttoastError(err);\n\t\t\t}\n\t\t};\n\t\tfetchSession();\n\t}, [whatsAppId]);\n\n\tuseEffect(() => {\n\t\tif (!whatsAppId) return;\n\t\tconst socket = openSocket();\n\n\t\tsocket.on(\"whatsappSession\", data => {\n\t\t\tif (data.action === \"update\" && data.session.id === whatsAppId) {\n\t\t\t\tsetQrCode(data.session.qrcode);\n\t\t\t}\n\n\t\t\tif (data.action === \"update\" && data.session.qrcode === \"\") {\n\t\t\t\tonClose();\n\t\t\t}\n\t\t});\n\n\t\treturn () => {\n\t\t\tsocket.disconnect();\n\t\t};\n\t}, [whatsAppId, onClose]);\n\n\treturn (\n\t\t<Dialog open={open} onClose={onClose} maxWidth=\"lg\" scroll=\"paper\">\n\t\t\t<DialogContent>\n\t\t\t\t<Paper elevation={0}>\n\t\t\t\t\t<Typography color=\"primary\" gutterBottom>\n\t\t\t\t\t\t{i18n.t(\"qrCode.message\")}\n\t\t\t\t\t</Typography>\n\t\t\t\t\t{qrCode ? (\n\t\t\t\t\t\t<QRCode value={qrCode} size={256} />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<span>Waiting for QR Code</span>\n\t\t\t\t\t)}\n\t\t\t\t</Paper>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n};\n\nexport default React.memo(QrcodeModal);\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,MAAO,CAAAC,MAAM,KAAM,cAAc,CACjC,MAAO,CAAAC,UAAU,KAAM,0BAA0B,CACjD,MAAO,CAAAC,UAAU,KAAM,yBAAyB,CAEhD,OAASC,MAAM,CAAEC,aAAa,CAAEC,KAAK,CAAEC,UAAU,KAAQ,mBAAmB,CAC5E,OAASC,IAAI,KAAQ,sBAAsB,CAC3C,MAAO,CAAAC,GAAG,KAAM,oBAAoB,CAEpC,KAAM,CAAAC,WAAW,CAAGC,IAAA,EAAmC,IAAlC,CAAEC,IAAI,CAAEC,OAAO,CAAEC,UAAW,CAAC,CAAAH,IAAA,CACjD,KAAM,CAACI,MAAM,CAAEC,SAAS,CAAC,CAAGhB,QAAQ,CAAC,EAAE,CAAC,CAExCD,SAAS,CAAC,IAAM,CACf,KAAM,CAAAkB,YAAY,CAAG,KAAAA,CAAA,GAAY,CAChC,GAAI,CAACH,UAAU,CAAE,OAEjB,GAAI,CACH,KAAM,CAAEI,IAAK,CAAC,CAAG,KAAM,CAAAT,GAAG,CAACU,GAAG,cAAAC,MAAA,CAAcN,UAAU,CAAE,CAAC,CACzDE,SAAS,CAACE,IAAI,CAACG,MAAM,CAAC,CACvB,CAAE,MAAOC,GAAG,CAAE,CACbnB,UAAU,CAACmB,GAAG,CAAC,CAChB,CACD,CAAC,CACDL,YAAY,CAAC,CAAC,CACf,CAAC,CAAE,CAACH,UAAU,CAAC,CAAC,CAEhBf,SAAS,CAAC,IAAM,CACf,GAAI,CAACe,UAAU,CAAE,OACjB,KAAM,CAAAS,MAAM,CAAGrB,UAAU,CAAC,CAAC,CAE3BqB,MAAM,CAACC,EAAE,CAAC,iBAAiB,CAAEN,IAAI,EAAI,CACpC,GAAIA,IAAI,CAACO,MAAM,GAAK,QAAQ,EAAIP,IAAI,CAACQ,OAAO,CAACC,EAAE,GAAKb,UAAU,CAAE,CAC/DE,SAAS,CAACE,IAAI,CAACQ,OAAO,CAACL,MAAM,CAAC,CAC/B,CAEA,GAAIH,IAAI,CAACO,MAAM,GAAK,QAAQ,EAAIP,IAAI,CAACQ,OAAO,CAACL,MAAM,GAAK,EAAE,CAAE,CAC3DR,OAAO,CAAC,CAAC,CACV,CACD,CAAC,CAAC,CAEF,MAAO,IAAM,CACZU,MAAM,CAACK,UAAU,CAAC,CAAC,CACpB,CAAC,CACF,CAAC,CAAE,CAACd,UAAU,CAAED,OAAO,CAAC,CAAC,CAEzB,mBACCf,KAAA,CAAA+B,aAAA,CAACzB,MAAM,EAACQ,IAAI,CAAEA,IAAK,CAACC,OAAO,CAAEA,OAAQ,CAACiB,QAAQ,CAAC,IAAI,CAACC,MAAM,CAAC,OAAO,eACjEjC,KAAA,CAAA+B,aAAA,CAACxB,aAAa,mBACbP,KAAA,CAAA+B,aAAA,CAACvB,KAAK,EAAC0B,SAAS,CAAE,CAAE,eACnBlC,KAAA,CAAA+B,aAAA,CAACtB,UAAU,EAAC0B,KAAK,CAAC,SAAS,CAACC,YAAY,OACtC1B,IAAI,CAAC2B,CAAC,CAAC,gBAAgB,CACb,CAAC,CACZpB,MAAM,cACNjB,KAAA,CAAA+B,aAAA,CAAC5B,MAAM,EAACmC,KAAK,CAAErB,MAAO,CAACsB,IAAI,CAAE,GAAI,CAAE,CAAC,cAEpCvC,KAAA,CAAA+B,aAAA,aAAM,qBAAyB,CAE1B,CACO,CACR,CAAC,CAEX,CAAC,CAED,cAAe,CAAA/B,KAAK,CAACwC,IAAI,CAAC5B,WAAW,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}