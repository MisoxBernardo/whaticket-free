{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useParams,useHistory}from\"react-router-dom\";import{toast}from\"react-toastify\";import openSocket from\"../../services/socket-io\";import clsx from\"clsx\";import{Paper,makeStyles}from\"@material-ui/core\";import{TagsContainer}from\"../TagsContainer\";import ContactDrawer from\"../ContactDrawer\";import MessageInput from\"../MessageInput/\";import TicketHeader from\"../TicketHeader\";import TicketInfo from\"../TicketInfo\";import TicketActionButtons from\"../TicketActionButtons\";import MessagesList from\"../MessagesList\";import api from\"../../services/api\";import{ReplyMessageProvider}from\"../../context/ReplyingMessage/ReplyingMessageContext\";import toastError from\"../../errors/toastError\";const drawerWidth=320;const useStyles=makeStyles(theme=>({root:{display:\"flex\",height:\"100%\",position:\"relative\",overflow:\"hidden\"},ticketInfo:{maxWidth:\"50%\",flexBasis:\"50%\",[theme.breakpoints.down(\"sm\")]:{maxWidth:\"80%\",flexBasis:\"80%\"}},ticketActionButtons:{maxWidth:\"50%\",flexBasis:\"50%\",display:\"flex\",[theme.breakpoints.down(\"sm\")]:{maxWidth:\"100%\",flexBasis:\"100%\",marginBottom:\"5px\"}},mainWrapper:{flex:1,height:\"100%\",display:\"flex\",flexDirection:\"column\",overflow:\"hidden\",borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:\"0\",marginRight:-drawerWidth,transition:theme.transitions.create(\"margin\",{easing:theme.transitions.easing.sharp,duration:theme.transitions.duration.leavingScreen})},mainWrapperShift:{borderTopRightRadius:0,borderBottomRightRadius:0,transition:theme.transitions.create(\"margin\",{easing:theme.transitions.easing.easeOut,duration:theme.transitions.duration.enteringScreen}),marginRight:0}}));const Ticket=()=>{const{ticketId}=useParams();const history=useHistory();const classes=useStyles();const[drawerOpen,setDrawerOpen]=useState(false);const[loading,setLoading]=useState(true);const[contact,setContact]=useState({});const[ticket,setTicket]=useState({});useEffect(()=>{setLoading(true);const delayDebounceFn=setTimeout(()=>{const fetchTicket=async()=>{try{const{data}=await api.get(\"/tickets/\"+ticketId);setContact(data.contact);setTicket(data);setLoading(false);}catch(err){setLoading(false);toastError(err);}};fetchTicket();},500);return()=>clearTimeout(delayDebounceFn);},[ticketId,history]);useEffect(()=>{const socket=openSocket();socket.on(\"ready\",()=>socket.emit(\"joinChatBox\",ticketId));socket.on(\"ticket\",data=>{if(data.action===\"update\"){setTicket(data.ticket);}if(data.action===\"delete\"){toast.success(\"Ticket deleted sucessfully.\");history.push(\"/tickets\");}});socket.on(\"contact\",data=>{if(data.action===\"update\"){setContact(prevState=>{var _data$contact;if(prevState.id===((_data$contact=data.contact)===null||_data$contact===void 0?void 0:_data$contact.id)){return{...prevState,...data.contact};}return prevState;});}});return()=>{socket.disconnect();};},[ticketId,history]);const handleDrawerOpen=()=>{setDrawerOpen(true);};const handleDrawerClose=()=>{setDrawerOpen(false);};return/*#__PURE__*/React.createElement(\"div\",{className:classes.root,id:\"drawer-container\"},/*#__PURE__*/React.createElement(Paper,{variant:\"outlined\",elevation:0,className:clsx(classes.mainWrapper,{[classes.mainWrapperShift]:drawerOpen})},/*#__PURE__*/React.createElement(TicketHeader,{loading:loading},/*#__PURE__*/React.createElement(\"div\",{className:classes.ticketInfo},/*#__PURE__*/React.createElement(TicketInfo,{contact:contact,ticket:ticket,onClick:handleDrawerOpen})),/*#__PURE__*/React.createElement(\"div\",{className:classes.ticketActionButtons},/*#__PURE__*/React.createElement(TicketActionButtons,{ticket:ticket}))),/*#__PURE__*/React.createElement(Paper,null,/*#__PURE__*/React.createElement(TagsContainer,{ticket:ticket})),/*#__PURE__*/React.createElement(ReplyMessageProvider,null,/*#__PURE__*/React.createElement(MessagesList,{ticketId:ticketId,isGroup:ticket.isGroup}),/*#__PURE__*/React.createElement(MessageInput,{ticketStatus:ticket.status}))),/*#__PURE__*/React.createElement(ContactDrawer,{open:drawerOpen,handleDrawerClose:handleDrawerClose,contact:contact,loading:loading}));};export default Ticket;","map":{"version":3,"names":["React","useState","useEffect","useParams","useHistory","toast","openSocket","clsx","Paper","makeStyles","TagsContainer","ContactDrawer","MessageInput","TicketHeader","TicketInfo","TicketActionButtons","MessagesList","api","ReplyMessageProvider","toastError","drawerWidth","useStyles","theme","root","display","height","position","overflow","ticketInfo","maxWidth","flexBasis","breakpoints","down","ticketActionButtons","marginBottom","mainWrapper","flex","flexDirection","borderTopLeftRadius","borderBottomLeftRadius","borderLeft","marginRight","transition","transitions","create","easing","sharp","duration","leavingScreen","mainWrapperShift","borderTopRightRadius","borderBottomRightRadius","easeOut","enteringScreen","Ticket","ticketId","history","classes","drawerOpen","setDrawerOpen","loading","setLoading","contact","setContact","ticket","setTicket","delayDebounceFn","setTimeout","fetchTicket","data","get","err","clearTimeout","socket","on","emit","action","success","push","prevState","_data$contact","id","disconnect","handleDrawerOpen","handleDrawerClose","createElement","className","variant","elevation","onClick","isGroup","ticketStatus","status","open"],"sources":["/home/user/whaticket-free/frontend/src/components/Ticket/index.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\n\nimport { toast } from \"react-toastify\";\nimport openSocket from \"../../services/socket-io\";\nimport clsx from \"clsx\";\n\nimport { Paper, makeStyles } from \"@material-ui/core\";\nimport { TagsContainer } from \"../TagsContainer\";\n\nimport ContactDrawer from \"../ContactDrawer\";\nimport MessageInput from \"../MessageInput/\";\nimport TicketHeader from \"../TicketHeader\";\nimport TicketInfo from \"../TicketInfo\";\nimport TicketActionButtons from \"../TicketActionButtons\";\nimport MessagesList from \"../MessagesList\";\nimport api from \"../../services/api\";\nimport { ReplyMessageProvider } from \"../../context/ReplyingMessage/ReplyingMessageContext\";\nimport toastError from \"../../errors/toastError\";\n\nconst drawerWidth = 320;\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: \"flex\",\n    height: \"100%\",\n    position: \"relative\",\n    overflow: \"hidden\",\n  },\n\n  ticketInfo: {\n    maxWidth: \"50%\",\n    flexBasis: \"50%\",\n    [theme.breakpoints.down(\"sm\")]: {\n      maxWidth: \"80%\",\n      flexBasis: \"80%\",\n    },\n  },\n  ticketActionButtons: {\n    maxWidth: \"50%\",\n    flexBasis: \"50%\",\n    display: \"flex\",\n    [theme.breakpoints.down(\"sm\")]: {\n      maxWidth: \"100%\",\n      flexBasis: \"100%\",\n      marginBottom: \"5px\",\n    },\n  },\n\n  mainWrapper: {\n    flex: 1,\n    height: \"100%\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    overflow: \"hidden\",\n    borderTopLeftRadius: 0,\n    borderBottomLeftRadius: 0,\n    borderLeft: \"0\",\n    marginRight: -drawerWidth,\n    transition: theme.transitions.create(\"margin\", {\n      easing: theme.transitions.easing.sharp,\n      duration: theme.transitions.duration.leavingScreen,\n    }),\n  },\n\n  mainWrapperShift: {\n    borderTopRightRadius: 0,\n    borderBottomRightRadius: 0,\n    transition: theme.transitions.create(\"margin\", {\n      easing: theme.transitions.easing.easeOut,\n      duration: theme.transitions.duration.enteringScreen,\n    }),\n    marginRight: 0,\n  },\n}));\n\nconst Ticket = () => {\n  const { ticketId } = useParams();\n  const history = useHistory();\n  const classes = useStyles();\n\n  const [drawerOpen, setDrawerOpen] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [contact, setContact] = useState({});\n  const [ticket, setTicket] = useState({});\n\n  useEffect(() => {\n    setLoading(true);\n    const delayDebounceFn = setTimeout(() => {\n      const fetchTicket = async () => {\n        try {\n          const { data } = await api.get(\"/tickets/\" + ticketId);\n\n          setContact(data.contact);\n          setTicket(data);\n          setLoading(false);\n        } catch (err) {\n          setLoading(false);\n          toastError(err);\n        }\n      };\n      fetchTicket();\n    }, 500);\n    return () => clearTimeout(delayDebounceFn);\n  }, [ticketId, history]);\n\n  useEffect(() => {\n    const socket = openSocket();\n\n    socket.on(\"ready\", () => socket.emit(\"joinChatBox\", ticketId));\n\n    socket.on(\"ticket\", (data) => {\n      if (data.action === \"update\") {\n        setTicket(data.ticket);\n      }\n\n      if (data.action === \"delete\") {\n        toast.success(\"Ticket deleted sucessfully.\");\n        history.push(\"/tickets\");\n      }\n    });\n\n    socket.on(\"contact\", (data) => {\n      if (data.action === \"update\") {\n        setContact((prevState) => {\n          if (prevState.id === data.contact?.id) {\n            return { ...prevState, ...data.contact };\n          }\n          return prevState;\n        });\n      }\n    });\n\n    return () => {\n      socket.disconnect();\n    };\n  }, [ticketId, history]);\n\n  const handleDrawerOpen = () => {\n    setDrawerOpen(true);\n  };\n\n  const handleDrawerClose = () => {\n    setDrawerOpen(false);\n  };\n\n  return (\n    <div className={classes.root} id=\"drawer-container\">\n      <Paper\n        variant=\"outlined\"\n        elevation={0}\n        className={clsx(classes.mainWrapper, {\n          [classes.mainWrapperShift]: drawerOpen,\n        })}\n      >\n        <TicketHeader loading={loading}>\n          <div className={classes.ticketInfo}>\n            <TicketInfo\n              contact={contact}\n              ticket={ticket}\n              onClick={handleDrawerOpen}\n            />\n          </div>\n          <div className={classes.ticketActionButtons}>\n            <TicketActionButtons ticket={ticket} />\n          </div>\n        </TicketHeader>\n        <Paper>\n          <TagsContainer ticket={ticket} />\n        </Paper>\n        <ReplyMessageProvider>\n          <MessagesList\n            ticketId={ticketId}\n            isGroup={ticket.isGroup}\n          ></MessagesList>\n          <MessageInput ticketStatus={ticket.status} />\n        </ReplyMessageProvider>\n      </Paper>\n      <ContactDrawer\n        open={drawerOpen}\n        handleDrawerClose={handleDrawerClose}\n        contact={contact}\n        loading={loading}\n      />\n    </div>\n  );\n};\n\nexport default Ticket;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}