{"ast":null,"code":"import { useState, useEffect, useReducer } from \"react\";\nimport openSocket from \"../../services/socket-io\";\nimport toastError from \"../../errors/toastError\";\nimport api from \"../../services/api\";\nconst reducer = (state, action) => {\n  if (action.type === \"LOAD_WHATSAPPS\") {\n    const whatsApps = action.payload;\n    return [...whatsApps];\n  }\n  if (action.type === \"UPDATE_WHATSAPPS\") {\n    const whatsApp = action.payload;\n    const whatsAppIndex = state.findIndex(s => s.id === whatsApp.id);\n    if (whatsAppIndex !== -1) {\n      state[whatsAppIndex] = whatsApp;\n      return [...state];\n    } else {\n      return [whatsApp, ...state];\n    }\n  }\n  if (action.type === \"UPDATE_SESSION\") {\n    const whatsApp = action.payload;\n    const whatsAppIndex = state.findIndex(s => s.id === whatsApp.id);\n    if (whatsAppIndex !== -1) {\n      state[whatsAppIndex].status = whatsApp.status;\n      state[whatsAppIndex].updatedAt = whatsApp.updatedAt;\n      state[whatsAppIndex].qrcode = whatsApp.qrcode;\n      state[whatsAppIndex].retries = whatsApp.retries;\n      return [...state];\n    } else {\n      return [...state];\n    }\n  }\n  if (action.type === \"DELETE_WHATSAPPS\") {\n    const whatsAppId = action.payload;\n    const whatsAppIndex = state.findIndex(s => s.id === whatsAppId);\n    if (whatsAppIndex !== -1) {\n      state.splice(whatsAppIndex, 1);\n    }\n    return [...state];\n  }\n  if (action.type === \"RESET\") {\n    return [];\n  }\n};\nconst useWhatsApps = () => {\n  const [whatsApps, dispatch] = useReducer(reducer, []);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    setLoading(true);\n    const fetchSession = async () => {\n      try {\n        const {\n          data\n        } = await api.get(\"/whatsapp/\");\n        dispatch({\n          type: \"LOAD_WHATSAPPS\",\n          payload: data\n        });\n        setLoading(false);\n      } catch (err) {\n        setLoading(false);\n        toastError(err);\n      }\n    };\n    fetchSession();\n  }, []);\n  useEffect(() => {\n    const socket = openSocket();\n    socket.on(\"whatsapp\", data => {\n      if (data.action === \"update\") {\n        dispatch({\n          type: \"UPDATE_WHATSAPPS\",\n          payload: data.whatsapp\n        });\n      }\n    });\n    socket.on(\"whatsapp\", data => {\n      if (data.action === \"delete\") {\n        dispatch({\n          type: \"DELETE_WHATSAPPS\",\n          payload: data.whatsappId\n        });\n      }\n    });\n    socket.on(\"whatsappSession\", data => {\n      if (data.action === \"update\") {\n        dispatch({\n          type: \"UPDATE_SESSION\",\n          payload: data.session\n        });\n      }\n    });\n    return () => {\n      socket.disconnect();\n    };\n  }, []);\n  return {\n    whatsApps,\n    loading\n  };\n};\nexport default useWhatsApps;","map":{"version":3,"names":["useState","useEffect","useReducer","openSocket","toastError","api","reducer","state","action","type","whatsApps","payload","whatsApp","whatsAppIndex","findIndex","s","id","status","updatedAt","qrcode","retries","whatsAppId","splice","useWhatsApps","dispatch","loading","setLoading","fetchSession","data","get","err","socket","on","whatsapp","whatsappId","session","disconnect"],"sources":["/home/user/whaticket-free/frontend/src/hooks/useWhatsApps/index.js"],"sourcesContent":["import { useState, useEffect, useReducer } from \"react\";\nimport openSocket from \"../../services/socket-io\";\nimport toastError from \"../../errors/toastError\";\n\nimport api from \"../../services/api\";\n\nconst reducer = (state, action) => {\n\tif (action.type === \"LOAD_WHATSAPPS\") {\n\t\tconst whatsApps = action.payload;\n\n\t\treturn [...whatsApps];\n\t}\n\n\tif (action.type === \"UPDATE_WHATSAPPS\") {\n\t\tconst whatsApp = action.payload;\n\t\tconst whatsAppIndex = state.findIndex(s => s.id === whatsApp.id);\n\n\t\tif (whatsAppIndex !== -1) {\n\t\t\tstate[whatsAppIndex] = whatsApp;\n\t\t\treturn [...state];\n\t\t} else {\n\t\t\treturn [whatsApp, ...state];\n\t\t}\n\t}\n\n\tif (action.type === \"UPDATE_SESSION\") {\n\t\tconst whatsApp = action.payload;\n\t\tconst whatsAppIndex = state.findIndex(s => s.id === whatsApp.id);\n\n\t\tif (whatsAppIndex !== -1) {\n\t\t\tstate[whatsAppIndex].status = whatsApp.status;\n\t\t\tstate[whatsAppIndex].updatedAt = whatsApp.updatedAt;\n\t\t\tstate[whatsAppIndex].qrcode = whatsApp.qrcode;\n\t\t\tstate[whatsAppIndex].retries = whatsApp.retries;\n\t\t\treturn [...state];\n\t\t} else {\n\t\t\treturn [...state];\n\t\t}\n\t}\n\n\tif (action.type === \"DELETE_WHATSAPPS\") {\n\t\tconst whatsAppId = action.payload;\n\n\t\tconst whatsAppIndex = state.findIndex(s => s.id === whatsAppId);\n\t\tif (whatsAppIndex !== -1) {\n\t\t\tstate.splice(whatsAppIndex, 1);\n\t\t}\n\t\treturn [...state];\n\t}\n\n\tif (action.type === \"RESET\") {\n\t\treturn [];\n\t}\n};\n\nconst useWhatsApps = () => {\n\tconst [whatsApps, dispatch] = useReducer(reducer, []);\n\tconst [loading, setLoading] = useState(true);\n\n\tuseEffect(() => {\n\t\tsetLoading(true);\n\t\tconst fetchSession = async () => {\n\t\t\ttry {\n\t\t\t\tconst { data } = await api.get(\"/whatsapp/\");\n\t\t\t\tdispatch({ type: \"LOAD_WHATSAPPS\", payload: data });\n\t\t\t\tsetLoading(false);\n\t\t\t} catch (err) {\n\t\t\t\tsetLoading(false);\n\t\t\t\ttoastError(err);\n\t\t\t}\n\t\t};\n\t\tfetchSession();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tconst socket = openSocket();\n\n\t\tsocket.on(\"whatsapp\", data => {\n\t\t\tif (data.action === \"update\") {\n\t\t\t\tdispatch({ type: \"UPDATE_WHATSAPPS\", payload: data.whatsapp });\n\t\t\t}\n\t\t});\n\n\t\tsocket.on(\"whatsapp\", data => {\n\t\t\tif (data.action === \"delete\") {\n\t\t\t\tdispatch({ type: \"DELETE_WHATSAPPS\", payload: data.whatsappId });\n\t\t\t}\n\t\t});\n\n\t\tsocket.on(\"whatsappSession\", data => {\n\t\t\tif (data.action === \"update\") {\n\t\t\t\tdispatch({ type: \"UPDATE_SESSION\", payload: data.session });\n\t\t\t}\n\t\t});\n\n\t\treturn () => {\n\t\t\tsocket.disconnect();\n\t\t};\n\t}, []);\n\n\treturn { whatsApps, loading };\n};\n\nexport default useWhatsApps;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}