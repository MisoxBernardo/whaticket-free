{"ast":null,"code":"var _jsxFileName = \"/home/user/whaticket-free/frontend/src/components/MessagesList/index.js\";\nimport React, { useState, useEffect, useReducer, useRef } from \"react\";\nimport { isSameDay, parseISO, format } from \"date-fns\";\nimport openSocket from \"../../services/socket-io\";\nimport clsx from \"clsx\";\nimport { green } from \"@material-ui/core/colors\";\nimport { Button, CircularProgress, Divider, IconButton, makeStyles } from \"@material-ui/core\";\nimport { AccessTime, Block, Done, DoneAll, ExpandMore, GetApp } from \"@material-ui/icons\";\nimport MarkdownWrapper from \"../MarkdownWrapper\";\nimport VcardPreview from \"../VcardPreview\";\nimport LocationPreview from \"../LocationPreview\";\nimport ModalImageCors from \"../ModalImageCors\";\nimport MessageOptionsMenu from \"../MessageOptionsMenu\";\nimport whatsBackground from \"../../assets/wa-background.png\";\nimport api from \"../../services/api\";\nimport toastError from \"../../errors/toastError\";\nconst useStyles = makeStyles(theme => ({\n  messagesListWrapper: {\n    overflow: \"hidden\",\n    position: \"relative\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: 1\n  },\n  messageCenter: {\n    marginTop: 5,\n    alignItems: \"center\",\n    verticalAlign: \"center\",\n    alignContent: \"center\",\n    backgroundColor: \"#E1F5FEEB\",\n    fontSize: \"12px\",\n    minWidth: 100,\n    maxWidth: 270,\n    color: \"#272727\",\n    borderTopLeftRadius: 0,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n    paddingLeft: 5,\n    paddingRight: 5,\n    paddingTop: 5,\n    paddingBottom: 0,\n    boxShadow: \"0 1px 1px #b3b3b3\"\n  },\n  messagesList: {\n    backgroundImage: `url(${whatsBackground})`,\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: 1,\n    padding: \"20px 20px 20px 20px\",\n    overflowY: \"scroll\",\n    [theme.breakpoints.down(\"sm\")]: {\n      paddingBottom: \"90px\"\n    },\n    ...theme.scrollbarStyles\n  },\n  circleLoading: {\n    color: green[500],\n    position: \"absolute\",\n    opacity: \"70%\",\n    top: 0,\n    left: \"50%\",\n    marginTop: 12\n  },\n  messageLeft: {\n    marginRight: 20,\n    marginTop: 2,\n    minWidth: 100,\n    maxWidth: 600,\n    height: \"auto\",\n    display: \"block\",\n    position: \"relative\",\n    \"&:hover #messageActionsButton\": {\n      display: \"flex\",\n      position: \"absolute\",\n      top: 0,\n      right: 0\n    },\n    whiteSpace: \"pre-wrap\",\n    backgroundColor: \"#ffffff\",\n    color: \"#303030\",\n    alignSelf: \"flex-start\",\n    borderTopLeftRadius: 0,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n    paddingLeft: 5,\n    paddingRight: 5,\n    paddingTop: 5,\n    paddingBottom: 0,\n    boxShadow: \"0 1px 1px #b3b3b3\"\n  },\n  quotedContainerLeft: {\n    margin: \"-3px -80px 6px -6px\",\n    overflow: \"hidden\",\n    backgroundColor: \"#f0f0f0\",\n    borderRadius: \"7.5px\",\n    display: \"flex\",\n    position: \"relative\"\n  },\n  quotedMsg: {\n    padding: 10,\n    maxWidth: 300,\n    height: \"auto\",\n    display: \"block\",\n    whiteSpace: \"pre-wrap\",\n    overflow: \"hidden\"\n  },\n  quotedSideColorLeft: {\n    flex: \"none\",\n    width: \"4px\",\n    backgroundColor: \"#6bcbef\"\n  },\n  messageRight: {\n    marginLeft: 20,\n    marginTop: 2,\n    minWidth: 100,\n    maxWidth: 600,\n    height: \"auto\",\n    display: \"block\",\n    position: \"relative\",\n    \"&:hover #messageActionsButton\": {\n      display: \"flex\",\n      position: \"absolute\",\n      top: 0,\n      right: 0\n    },\n    whiteSpace: \"pre-wrap\",\n    backgroundColor: \"#dcf8c6\",\n    color: \"#303030\",\n    alignSelf: \"flex-end\",\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 0,\n    paddingLeft: 5,\n    paddingRight: 5,\n    paddingTop: 5,\n    paddingBottom: 0,\n    boxShadow: \"0 1px 1px #b3b3b3\"\n  },\n  quotedContainerRight: {\n    margin: \"-3px -80px 6px -6px\",\n    overflowY: \"hidden\",\n    backgroundColor: \"#cfe9ba\",\n    borderRadius: \"7.5px\",\n    display: \"flex\",\n    position: \"relative\"\n  },\n  quotedMsgRight: {\n    padding: 10,\n    maxWidth: 300,\n    height: \"auto\",\n    whiteSpace: \"pre-wrap\"\n  },\n  quotedSideColorRight: {\n    flex: \"none\",\n    width: \"4px\",\n    backgroundColor: \"#35cd96\"\n  },\n  messageActionsButton: {\n    display: \"none\",\n    position: \"relative\",\n    color: \"#999\",\n    zIndex: 1,\n    backgroundColor: \"inherit\",\n    opacity: \"90%\",\n    \"&:hover, &.Mui-focusVisible\": {\n      backgroundColor: \"inherit\"\n    }\n  },\n  messageContactName: {\n    display: \"flex\",\n    color: \"#6bcbef\",\n    fontWeight: 500\n  },\n  textContentItem: {\n    overflowWrap: \"break-word\",\n    padding: \"3px 80px 6px 6px\"\n  },\n  textContentItemDeleted: {\n    fontStyle: \"italic\",\n    color: \"rgba(0, 0, 0, 0.36)\",\n    overflowWrap: \"break-word\",\n    padding: \"3px 80px 6px 6px\"\n  },\n  messageMedia: {\n    objectFit: \"cover\",\n    width: 250,\n    height: 200,\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8\n  },\n  timestamp: {\n    fontSize: 11,\n    position: \"absolute\",\n    bottom: 0,\n    right: 5,\n    color: \"#999\"\n  },\n  dailyTimestamp: {\n    alignItems: \"center\",\n    textAlign: \"center\",\n    alignSelf: \"center\",\n    width: \"110px\",\n    backgroundColor: \"#e1f3fb\",\n    margin: \"10px\",\n    borderRadius: \"10px\",\n    boxShadow: \"0 1px 1px #b3b3b3\"\n  },\n  dailyTimestampText: {\n    color: \"#808888\",\n    padding: 8,\n    alignSelf: \"center\",\n    marginLeft: \"0px\"\n  },\n  ackIcons: {\n    fontSize: 18,\n    verticalAlign: \"middle\",\n    marginLeft: 4\n  },\n  deletedIcon: {\n    fontSize: 18,\n    verticalAlign: \"middle\",\n    marginRight: 4\n  },\n  ackDoneAllIcon: {\n    color: green[500],\n    fontSize: 18,\n    verticalAlign: \"middle\",\n    marginLeft: 4\n  },\n  downloadMedia: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    backgroundColor: \"inherit\",\n    padding: 10\n  }\n}));\nconst reducer = (state, action) => {\n  if (action.type === \"LOAD_MESSAGES\") {\n    const messages = action.payload;\n    const newMessages = [];\n    messages.forEach(message => {\n      const messageIndex = state.findIndex(m => m.id === message.id);\n      if (messageIndex !== -1) {\n        state[messageIndex] = message;\n      } else {\n        newMessages.push(message);\n      }\n    });\n    return [...newMessages, ...state];\n  }\n  if (action.type === \"ADD_MESSAGE\") {\n    const newMessage = action.payload;\n    const messageIndex = state.findIndex(m => m.id === newMessage.id);\n    if (messageIndex !== -1) {\n      state[messageIndex] = newMessage;\n    } else {\n      state.push(newMessage);\n    }\n    return [...state];\n  }\n  if (action.type === \"UPDATE_MESSAGE\") {\n    const messageToUpdate = action.payload;\n    const messageIndex = state.findIndex(m => m.id === messageToUpdate.id);\n    if (messageIndex !== -1) {\n      state[messageIndex] = messageToUpdate;\n    }\n    return [...state];\n  }\n  if (action.type === \"RESET\") {\n    return [];\n  }\n};\nconst MessagesList = ({\n  ticketId,\n  isGroup\n}) => {\n  const classes = useStyles();\n  const [messagesList, dispatch] = useReducer(reducer, []);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [hasMore, setHasMore] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const lastMessageRef = useRef();\n  const [selectedMessage, setSelectedMessage] = useState({});\n  const [anchorEl, setAnchorEl] = useState(null);\n  const messageOptionsMenuOpen = Boolean(anchorEl);\n  const currentTicketId = useRef(ticketId);\n  useEffect(() => {\n    dispatch({\n      type: \"RESET\"\n    });\n    setPageNumber(1);\n    currentTicketId.current = ticketId;\n  }, [ticketId]);\n  useEffect(() => {\n    setLoading(true);\n    const delayDebounceFn = setTimeout(() => {\n      const fetchMessages = async () => {\n        try {\n          const {\n            data\n          } = await api.get(\"/messages/\" + ticketId, {\n            params: {\n              pageNumber\n            }\n          });\n          if (currentTicketId.current === ticketId) {\n            dispatch({\n              type: \"LOAD_MESSAGES\",\n              payload: data.messages\n            });\n            setHasMore(data.hasMore);\n            setLoading(false);\n          }\n          if (pageNumber === 1 && data.messages.length > 1) {\n            scrollToBottom();\n          }\n        } catch (err) {\n          setLoading(false);\n          toastError(err);\n        }\n      };\n      fetchMessages();\n    }, 500);\n    return () => {\n      clearTimeout(delayDebounceFn);\n    };\n  }, [pageNumber, ticketId]);\n  useEffect(() => {\n    const socket = openSocket();\n    socket.on(\"ready\", () => socket.emit(\"joinChatBox\", ticketId));\n    socket.on(\"appMessage\", data => {\n      if (data.action === \"create\") {\n        dispatch({\n          type: \"ADD_MESSAGE\",\n          payload: data.message\n        });\n        scrollToBottom();\n      }\n      if (data.action === \"update\") {\n        dispatch({\n          type: \"UPDATE_MESSAGE\",\n          payload: data.message\n        });\n      }\n    });\n    return () => {\n      socket.disconnect();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ticketId]);\n  const loadMore = () => {\n    setPageNumber(prevPageNumber => prevPageNumber + 1);\n  };\n  const scrollToBottom = () => {\n    if (lastMessageRef.current) {\n      lastMessageRef.current.scrollIntoView({});\n    }\n  };\n  const handleScroll = e => {\n    if (!hasMore) return;\n    const {\n      scrollTop\n    } = e.currentTarget;\n    if (scrollTop === 0) {\n      document.getElementById(\"messagesList\").scrollTop = 1;\n    }\n    if (loading) {\n      return;\n    }\n    if (scrollTop < 50) {\n      loadMore();\n    }\n  };\n  const handleOpenMessageOptionsMenu = (e, message) => {\n    setAnchorEl(e.currentTarget);\n    setSelectedMessage(message);\n  };\n  const handleCloseMessageOptionsMenu = e => {\n    setAnchorEl(null);\n  };\n  const checkMessageMedia = message => {\n    if (message.mediaType === \"locationMessage\" && message.body.split('|').length >= 2) {\n      try {\n        let locationParts = message.body.split('|');\n        let imageLocation = locationParts[0];\n        let linkLocation = locationParts[1];\n        let descriptionLocation = null;\n        if (locationParts.length > 2) {\n          var _message$body;\n          descriptionLocation = message === null || message === void 0 ? void 0 : (_message$body = message.body) === null || _message$body === void 0 ? void 0 : _message$body.split('|')[2];\n        }\n        return /*#__PURE__*/React.createElement(LocationPreview, {\n          image: imageLocation,\n          link: linkLocation,\n          description: descriptionLocation,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 16\n          }\n        });\n      } catch (err) {\n        console.log(\"checkMessageMedia ~ err\", err);\n      }\n    } else if (message.mediaType === \"contactMessage\") {\n      let array = message.body.split(\"\\n\");\n      let obj = [];\n      let contact = \"\";\n      for (let index = 0; index < array.length; index++) {\n        const v = array[index];\n        let values = v.split(\":\");\n        for (let ind = 0; ind < values.length; ind++) {\n          if (values[ind].indexOf(\"+\") !== -1) {\n            obj.push({\n              number: values[ind]\n            });\n          }\n          if (values[ind].indexOf(\"FN\") !== -1) {\n            contact = values[ind + 1];\n          }\n        }\n      }\n      return /*#__PURE__*/React.createElement(VcardPreview, {\n        contact: contact,\n        numbers: obj[0].number,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 474,\n          columnNumber: 16\n        }\n      });\n    }\n    /*else if (message.mediaType === \"multi_vcard\") {\n          \t\n      if(message.body !== null && message.body !== \"\") {\n        let newBody = JSON.parse(message.body)\n        return (\n          <>\n            {\n            newBody.map(v => (\n              <VcardPreview contact={v.name} numbers={v.number} />\n            ))\n            }\n          </>\n        )\n      } else return (<></>)\n    }*/else if (message.mediaType === \"image\") {\n      return /*#__PURE__*/React.createElement(ModalImageCors, {\n        imageUrl: message.mediaUrl,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 494,\n          columnNumber: 16\n        }\n      });\n    } else if (message.mediaType === \"audio\") {\n      return /*#__PURE__*/React.createElement(\"audio\", {\n        controls: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 497,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"source\", {\n        src: message.mediaUrl,\n        type: \"audio/ogg\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 498,\n          columnNumber: 13\n        }\n      }));\n    } else if (message.mediaType === \"video\") {\n      return /*#__PURE__*/React.createElement(\"video\", {\n        className: classes.messageMedia,\n        src: message.mediaUrl,\n        controls: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 504,\n          columnNumber: 11\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        className: classes.downloadMedia,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 514,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        startIcon: /*#__PURE__*/React.createElement(GetApp, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 516,\n            columnNumber: 28\n          }\n        }),\n        color: \"primary\",\n        variant: \"outlined\",\n        target: \"_blank\",\n        href: message.mediaUrl,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 515,\n          columnNumber: 15\n        }\n      }, \"Download\")), /*#__PURE__*/React.createElement(Divider, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 525,\n          columnNumber: 13\n        }\n      }));\n    }\n  };\n  const renderMessageAck = message => {\n    if (message.ack === 0) {\n      return /*#__PURE__*/React.createElement(AccessTime, {\n        fontSize: \"small\",\n        className: classes.ackIcons,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 533,\n          columnNumber: 14\n        }\n      });\n    }\n    if (message.ack === 1) {\n      return /*#__PURE__*/React.createElement(Done, {\n        fontSize: \"small\",\n        className: classes.ackIcons,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 536,\n          columnNumber: 14\n        }\n      });\n    }\n    if (message.ack === 2) {\n      return /*#__PURE__*/React.createElement(Done, {\n        fontSize: \"small\",\n        className: classes.ackIcons,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 539,\n          columnNumber: 14\n        }\n      });\n    }\n    if (message.ack === 3) {\n      return /*#__PURE__*/React.createElement(DoneAll, {\n        fontSize: \"small\",\n        className: classes.ackIcons,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 542,\n          columnNumber: 14\n        }\n      });\n    }\n    if (message.ack === 4 || message.ack === 5) {\n      return /*#__PURE__*/React.createElement(DoneAll, {\n        fontSize: \"small\",\n        className: classes.ackDoneAllIcon,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 545,\n          columnNumber: 14\n        }\n      });\n    }\n  };\n  const renderDailyTimestamps = (message, index) => {\n    if (index === 0) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        className: classes.dailyTimestamp,\n        key: `timestamp-${message.id}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 552,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: classes.dailyTimestampText,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 556,\n          columnNumber: 11\n        }\n      }, format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")));\n    }\n    if (index < messagesList.length - 1) {\n      let messageDay = parseISO(messagesList[index].createdAt);\n      let previousMessageDay = parseISO(messagesList[index - 1].createdAt);\n      if (!isSameDay(messageDay, previousMessageDay)) {\n        return /*#__PURE__*/React.createElement(\"span\", {\n          className: classes.dailyTimestamp,\n          key: `timestamp-${message.id}`,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 568,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: classes.dailyTimestampText,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 572,\n            columnNumber: 13\n          }\n        }, format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")));\n      }\n    }\n    if (index === messagesList.length - 1) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        key: `ref-${message.createdAt}`,\n        ref: lastMessageRef,\n        style: {\n          float: \"left\",\n          clear: \"both\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 581,\n          columnNumber: 9\n        }\n      });\n    }\n  };\n  const renderMessageDivider = (message, index) => {\n    if (index < messagesList.length && index > 0) {\n      let messageUser = messagesList[index].fromMe;\n      let previousMessageUser = messagesList[index - 1].fromMe;\n      if (messageUser !== previousMessageUser) {\n        return /*#__PURE__*/React.createElement(\"span\", {\n          style: {\n            marginTop: 16\n          },\n          key: `divider-${message.id}`,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 597,\n            columnNumber: 11\n          }\n        });\n      }\n    }\n  };\n  const renderNumberTicket = (message, index) => {\n    if (index < messagesList.length && index > 0) {\n      let messageTicket = message.ticketId;\n      let previousMessageTicket = messagesList[index - 1].ticketId;\n      if (messageTicket !== previousMessageTicket) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          key: `ticket-${message.id}`,\n          className: classes.ticketNunber,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 11\n          }\n        }, \"#ticket: \", messageTicket, /*#__PURE__*/React.createElement(\"hr\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 611,\n            columnNumber: 13\n          }\n        }));\n      }\n    }\n  };\n  const renderQuotedMessage = message => {\n    var _message$quotedMsg, _message$quotedMsg2, _message$quotedMsg3, _message$quotedMsg3$c, _message$quotedMsg4;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: clsx(classes.quotedContainerLeft, {\n        [classes.quotedContainerRight]: message.fromMe\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 620,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: clsx(classes.quotedSideColorLeft, {\n        [classes.quotedSideColorRight]: (_message$quotedMsg = message.quotedMsg) === null || _message$quotedMsg === void 0 ? void 0 : _message$quotedMsg.fromMe\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 625,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.quotedMsg,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 630,\n        columnNumber: 9\n      }\n    }, !((_message$quotedMsg2 = message.quotedMsg) === null || _message$quotedMsg2 === void 0 ? void 0 : _message$quotedMsg2.fromMe) && /*#__PURE__*/React.createElement(\"span\", {\n      className: classes.messageContactName,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 632,\n        columnNumber: 13\n      }\n    }, (_message$quotedMsg3 = message.quotedMsg) === null || _message$quotedMsg3 === void 0 ? void 0 : (_message$quotedMsg3$c = _message$quotedMsg3.contact) === null || _message$quotedMsg3$c === void 0 ? void 0 : _message$quotedMsg3$c.name), (_message$quotedMsg4 = message.quotedMsg) === null || _message$quotedMsg4 === void 0 ? void 0 : _message$quotedMsg4.body));\n  };\n  const renderMessages = () => {\n    if (messagesList.length > 0) {\n      const viewMessagesList = messagesList.map((message, index) => {\n        if (message.mediaType === \"call_log\") {\n          var _message$contact;\n          return /*#__PURE__*/React.createElement(React.Fragment, {\n            key: message.id,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 647,\n              columnNumber: 13\n            }\n          }, renderDailyTimestamps(message, index), renderMessageDivider(message, index), renderNumberTicket(message, index), /*#__PURE__*/React.createElement(\"div\", {\n            className: classes.messageCenter,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 651,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(IconButton, {\n            variant: \"contained\",\n            size: \"small\",\n            id: \"messageActionsButton\",\n            disabled: message.isDeleted,\n            className: classes.messageActionsButton,\n            onClick: e => handleOpenMessageOptionsMenu(e, message),\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 652,\n              columnNumber: 17\n            }\n          }, /*#__PURE__*/React.createElement(ExpandMore, {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 660,\n              columnNumber: 19\n            }\n          })), isGroup && /*#__PURE__*/React.createElement(\"span\", {\n            className: classes.messageContactName,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 663,\n              columnNumber: 19\n            }\n          }, (_message$contact = message.contact) === null || _message$contact === void 0 ? void 0 : _message$contact.name), /*#__PURE__*/React.createElement(\"div\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 667,\n              columnNumber: 17\n            }\n          }, /*#__PURE__*/React.createElement(\"svg\", {\n            xmlns: \"http://www.w3.org/2000/svg\",\n            viewBox: \"0 0 20 17\",\n            width: \"20\",\n            height: \"17\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 668,\n              columnNumber: 19\n            }\n          }, /*#__PURE__*/React.createElement(\"path\", {\n            fill: \"#df3333\",\n            d: \"M18.2 12.1c-1.5-1.8-5-2.7-8.2-2.7s-6.7 1-8.2 2.7c-.7.8-.3 2.3.2 2.8.2.2.3.3.5.3 1.4 0 3.6-.7 3.6-.7.5-.2.8-.5.8-1v-1.3c.7-1.2 5.4-1.2 6.4-.1l.1.1v1.3c0 .2.1.4.2.6.1.2.3.3.5.4 0 0 2.2.7 3.6.7.2 0 1.4-2 .5-3.1zM5.4 3.2l4.7 4.6 5.8-5.7-.9-.8L10.1 6 6.4 2.3h2.5V1H4.1v4.8h1.3V3.2z\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 669,\n              columnNumber: 21\n            }\n          })), \" \", /*#__PURE__*/React.createElement(\"span\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 670,\n              columnNumber: 26\n            }\n          }, \"Chamada de voz/v\\xEDdeo perdida \\xE0s \", format(parseISO(message.createdAt), \"HH:mm\")))));\n        }\n        if (!message.fromMe) {\n          var _message$contact2;\n          return /*#__PURE__*/React.createElement(React.Fragment, {\n            key: message.id,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 678,\n              columnNumber: 13\n            }\n          }, renderDailyTimestamps(message, index), renderMessageDivider(message, index), renderNumberTicket(message, index), /*#__PURE__*/React.createElement(\"div\", {\n            className: classes.messageLeft,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 682,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(IconButton, {\n            variant: \"contained\",\n            size: \"small\",\n            id: \"messageActionsButton\",\n            disabled: message.isDeleted,\n            className: classes.messageActionsButton,\n            onClick: e => handleOpenMessageOptionsMenu(e, message),\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 683,\n              columnNumber: 17\n            }\n          }, /*#__PURE__*/React.createElement(ExpandMore, {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 691,\n              columnNumber: 19\n            }\n          })), isGroup && /*#__PURE__*/React.createElement(\"span\", {\n            className: classes.messageContactName,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 694,\n              columnNumber: 19\n            }\n          }, (_message$contact2 = message.contact) === null || _message$contact2 === void 0 ? void 0 : _message$contact2.name), (message.mediaUrl || message.mediaType === \"contactMessage\" || message.mediaType === \"locationMessage\"\n          //|| message.mediaType === \"multi_vcard\" \n          ) && checkMessageMedia(message), /*#__PURE__*/React.createElement(\"div\", {\n            className: classes.textContentItem,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 702,\n              columnNumber: 17\n            }\n          }, message.quotedMsg && renderQuotedMessage(message), /*#__PURE__*/React.createElement(MarkdownWrapper, {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 704,\n              columnNumber: 19\n            }\n          }, message.body), /*#__PURE__*/React.createElement(\"span\", {\n            className: classes.timestamp,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 705,\n              columnNumber: 19\n            }\n          }, format(parseISO(message.createdAt), \"HH:mm\")))));\n        } else {\n          return /*#__PURE__*/React.createElement(React.Fragment, {\n            key: message.id,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 714,\n              columnNumber: 13\n            }\n          }, renderDailyTimestamps(message, index), renderMessageDivider(message, index), renderNumberTicket(message, index), /*#__PURE__*/React.createElement(\"div\", {\n            className: classes.messageRight,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 718,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(IconButton, {\n            variant: \"contained\",\n            size: \"small\",\n            id: \"messageActionsButton\",\n            disabled: message.isDeleted,\n            className: classes.messageActionsButton,\n            onClick: e => handleOpenMessageOptionsMenu(e, message),\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 719,\n              columnNumber: 17\n            }\n          }, /*#__PURE__*/React.createElement(ExpandMore, {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 727,\n              columnNumber: 19\n            }\n          })), (message.mediaUrl || message.mediaType === \"contactMessage\" || message.mediaType === \"locationMessage\"\n          //|| message.mediaType === \"multi_vcard\" \n          ) && checkMessageMedia(message), /*#__PURE__*/React.createElement(\"div\", {\n            className: clsx(classes.textContentItem, {\n              [classes.textContentItemDeleted]: message.isDeleted\n            }),\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 732,\n              columnNumber: 17\n            }\n          }, message.isDeleted && /*#__PURE__*/React.createElement(Block, {\n            color: \"disabled\",\n            fontSize: \"small\",\n            className: classes.deletedIcon,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 738,\n              columnNumber: 21\n            }\n          }), message.quotedMsg && renderQuotedMessage(message), /*#__PURE__*/React.createElement(MarkdownWrapper, {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 745,\n              columnNumber: 19\n            }\n          }, message.body), /*#__PURE__*/React.createElement(\"span\", {\n            className: classes.timestamp,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 746,\n              columnNumber: 19\n            }\n          }, format(parseISO(message.createdAt), \"HH:mm\"), renderMessageAck(message)))));\n        }\n      });\n      return viewMessagesList;\n    } else {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 758,\n          columnNumber: 14\n        }\n      }, \"Say hello to your new contact!\");\n    }\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.messagesListWrapper,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 763,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(MessageOptionsMenu, {\n    message: selectedMessage,\n    anchorEl: anchorEl,\n    menuOpen: messageOptionsMenuOpen,\n    handleClose: handleCloseMessageOptionsMenu,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 764,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"messagesList\",\n    className: classes.messagesList,\n    onScroll: handleScroll,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 770,\n      columnNumber: 7\n    }\n  }, messagesList.length > 0 ? renderMessages() : []), loading && /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 778,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(CircularProgress, {\n    className: classes.circleLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 779,\n      columnNumber: 11\n    }\n  })));\n};\nexport default MessagesList;","map":{"version":3,"names":["React","useState","useEffect","useReducer","useRef","isSameDay","parseISO","format","openSocket","clsx","green","Button","CircularProgress","Divider","IconButton","makeStyles","AccessTime","Block","Done","DoneAll","ExpandMore","GetApp","MarkdownWrapper","VcardPreview","LocationPreview","ModalImageCors","MessageOptionsMenu","whatsBackground","api","toastError","useStyles","theme","messagesListWrapper","overflow","position","display","flexDirection","flexGrow","messageCenter","marginTop","alignItems","verticalAlign","alignContent","backgroundColor","fontSize","minWidth","maxWidth","color","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","paddingLeft","paddingRight","paddingTop","paddingBottom","boxShadow","messagesList","backgroundImage","padding","overflowY","breakpoints","down","scrollbarStyles","circleLoading","opacity","top","left","messageLeft","marginRight","height","right","whiteSpace","alignSelf","quotedContainerLeft","margin","borderRadius","quotedMsg","quotedSideColorLeft","flex","width","messageRight","marginLeft","quotedContainerRight","quotedMsgRight","quotedSideColorRight","messageActionsButton","zIndex","messageContactName","fontWeight","textContentItem","overflowWrap","textContentItemDeleted","fontStyle","messageMedia","objectFit","timestamp","bottom","dailyTimestamp","textAlign","dailyTimestampText","ackIcons","deletedIcon","ackDoneAllIcon","downloadMedia","justifyContent","reducer","state","action","type","messages","payload","newMessages","forEach","message","messageIndex","findIndex","m","id","push","newMessage","messageToUpdate","MessagesList","ticketId","isGroup","classes","dispatch","pageNumber","setPageNumber","hasMore","setHasMore","loading","setLoading","lastMessageRef","selectedMessage","setSelectedMessage","anchorEl","setAnchorEl","messageOptionsMenuOpen","Boolean","currentTicketId","current","delayDebounceFn","setTimeout","fetchMessages","data","get","params","length","scrollToBottom","err","clearTimeout","socket","on","emit","disconnect","loadMore","prevPageNumber","scrollIntoView","handleScroll","e","scrollTop","currentTarget","document","getElementById","handleOpenMessageOptionsMenu","handleCloseMessageOptionsMenu","checkMessageMedia","mediaType","body","split","locationParts","imageLocation","linkLocation","descriptionLocation","_message$body","createElement","image","link","description","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","console","log","array","obj","contact","index","v","values","ind","indexOf","number","numbers","imageUrl","mediaUrl","controls","src","className","Fragment","startIcon","variant","target","href","renderMessageAck","ack","renderDailyTimestamps","key","createdAt","messageDay","previousMessageDay","ref","style","float","clear","renderMessageDivider","messageUser","fromMe","previousMessageUser","renderNumberTicket","messageTicket","previousMessageTicket","ticketNunber","renderQuotedMessage","_message$quotedMsg","_message$quotedMsg2","_message$quotedMsg3","_message$quotedMsg3$c","_message$quotedMsg4","name","renderMessages","viewMessagesList","map","_message$contact","size","disabled","isDeleted","onClick","xmlns","viewBox","fill","d","_message$contact2","menuOpen","handleClose","onScroll"],"sources":["/home/user/whaticket-free/frontend/src/components/MessagesList/index.js"],"sourcesContent":["import React, { useState, useEffect, useReducer, useRef  } from \"react\";\n\nimport { isSameDay, parseISO, format } from \"date-fns\";\nimport openSocket from \"../../services/socket-io\";\nimport clsx from \"clsx\";\n\nimport { green } from \"@material-ui/core/colors\";\nimport {\n  Button,\n  CircularProgress,\n  Divider,\n  IconButton,\n  makeStyles,\n} from \"@material-ui/core\";\nimport {\n  AccessTime,\n  Block,\n  Done,\n  DoneAll,\n  ExpandMore,\n  GetApp,\n} from \"@material-ui/icons\";\n\nimport MarkdownWrapper from \"../MarkdownWrapper\";\nimport VcardPreview from \"../VcardPreview\";\nimport LocationPreview from \"../LocationPreview\";\nimport ModalImageCors from \"../ModalImageCors\";\nimport MessageOptionsMenu from \"../MessageOptionsMenu\";\nimport whatsBackground from \"../../assets/wa-background.png\";\n\nimport api from \"../../services/api\";\nimport toastError from \"../../errors/toastError\";\n\nconst useStyles = makeStyles((theme) => ({\n  messagesListWrapper: {\n    overflow: \"hidden\",\n    position: \"relative\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: 1,\n  },\n\n  messageCenter: {\n    marginTop: 5,\n    alignItems: \"center\",\n    verticalAlign: \"center\",\n    alignContent: \"center\",\n    backgroundColor: \"#E1F5FEEB\",\n    fontSize: \"12px\",\n    minWidth: 100,\n    maxWidth: 270,\n    color: \"#272727\",\n    borderTopLeftRadius: 0,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n    paddingLeft: 5,\n    paddingRight: 5,\n    paddingTop: 5,\n    paddingBottom: 0,\n    boxShadow: \"0 1px 1px #b3b3b3\",\n  },\n\n  messagesList: {\n    backgroundImage: `url(${whatsBackground})`,\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: 1,\n    padding: \"20px 20px 20px 20px\",\n    overflowY: \"scroll\",\n    [theme.breakpoints.down(\"sm\")]: {\n      paddingBottom: \"90px\",\n    },\n    ...theme.scrollbarStyles,\n  },\n\n  circleLoading: {\n    color: green[500],\n    position: \"absolute\",\n    opacity: \"70%\",\n    top: 0,\n    left: \"50%\",\n    marginTop: 12,\n  },\n\n  messageLeft: {\n    marginRight: 20,\n    marginTop: 2,\n    minWidth: 100,\n    maxWidth: 600,\n    height: \"auto\",\n    display: \"block\",\n    position: \"relative\",\n    \"&:hover #messageActionsButton\": {\n      display: \"flex\",\n      position: \"absolute\",\n      top: 0,\n      right: 0,\n    },\n\n    whiteSpace: \"pre-wrap\",\n    backgroundColor: \"#ffffff\",\n    color: \"#303030\",\n    alignSelf: \"flex-start\",\n    borderTopLeftRadius: 0,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n    paddingLeft: 5,\n    paddingRight: 5,\n    paddingTop: 5,\n    paddingBottom: 0,\n    boxShadow: \"0 1px 1px #b3b3b3\",\n  },\n\n  quotedContainerLeft: {\n    margin: \"-3px -80px 6px -6px\",\n    overflow: \"hidden\",\n    backgroundColor: \"#f0f0f0\",\n    borderRadius: \"7.5px\",\n    display: \"flex\",\n    position: \"relative\",\n  },\n\n  quotedMsg: {\n    padding: 10,\n    maxWidth: 300,\n    height: \"auto\",\n    display: \"block\",\n    whiteSpace: \"pre-wrap\",\n    overflow: \"hidden\",\n  },\n\n  quotedSideColorLeft: {\n    flex: \"none\",\n    width: \"4px\",\n    backgroundColor: \"#6bcbef\",\n  },\n\n  messageRight: {\n    marginLeft: 20,\n    marginTop: 2,\n    minWidth: 100,\n    maxWidth: 600,\n    height: \"auto\",\n    display: \"block\",\n    position: \"relative\",\n    \"&:hover #messageActionsButton\": {\n      display: \"flex\",\n      position: \"absolute\",\n      top: 0,\n      right: 0,\n    },\n\n    whiteSpace: \"pre-wrap\",\n    backgroundColor: \"#dcf8c6\",\n    color: \"#303030\",\n    alignSelf: \"flex-end\",\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 0,\n    paddingLeft: 5,\n    paddingRight: 5,\n    paddingTop: 5,\n    paddingBottom: 0,\n    boxShadow: \"0 1px 1px #b3b3b3\",\n  },\n\n  quotedContainerRight: {\n    margin: \"-3px -80px 6px -6px\",\n    overflowY: \"hidden\",\n    backgroundColor: \"#cfe9ba\",\n    borderRadius: \"7.5px\",\n    display: \"flex\",\n    position: \"relative\",\n  },\n\n  quotedMsgRight: {\n    padding: 10,\n    maxWidth: 300,\n    height: \"auto\",\n    whiteSpace: \"pre-wrap\",\n  },\n\n  quotedSideColorRight: {\n    flex: \"none\",\n    width: \"4px\",\n    backgroundColor: \"#35cd96\",\n  },\n\n  messageActionsButton: {\n    display: \"none\",\n    position: \"relative\",\n    color: \"#999\",\n    zIndex: 1,\n    backgroundColor: \"inherit\",\n    opacity: \"90%\",\n    \"&:hover, &.Mui-focusVisible\": { backgroundColor: \"inherit\" },\n  },\n\n  messageContactName: {\n    display: \"flex\",\n    color: \"#6bcbef\",\n    fontWeight: 500,\n  },\n\n  textContentItem: {\n    overflowWrap: \"break-word\",\n    padding: \"3px 80px 6px 6px\",\n  },\n\n  textContentItemDeleted: {\n    fontStyle: \"italic\",\n    color: \"rgba(0, 0, 0, 0.36)\",\n    overflowWrap: \"break-word\",\n    padding: \"3px 80px 6px 6px\",\n  },\n\n  messageMedia: {\n    objectFit: \"cover\",\n    width: 250,\n    height: 200,\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n  },\n\n  timestamp: {\n    fontSize: 11,\n    position: \"absolute\",\n    bottom: 0,\n    right: 5,\n    color: \"#999\",\n  },\n\n  dailyTimestamp: {\n    alignItems: \"center\",\n    textAlign: \"center\",\n    alignSelf: \"center\",\n    width: \"110px\",\n    backgroundColor: \"#e1f3fb\",\n    margin: \"10px\",\n    borderRadius: \"10px\",\n    boxShadow: \"0 1px 1px #b3b3b3\",\n  },\n\n  dailyTimestampText: {\n    color: \"#808888\",\n    padding: 8,\n    alignSelf: \"center\",\n    marginLeft: \"0px\",\n  },\n\n  ackIcons: {\n    fontSize: 18,\n    verticalAlign: \"middle\",\n    marginLeft: 4,\n  },\n\n  deletedIcon: {\n    fontSize: 18,\n    verticalAlign: \"middle\",\n    marginRight: 4,\n  },\n\n  ackDoneAllIcon: {\n    color: green[500],\n    fontSize: 18,\n    verticalAlign: \"middle\",\n    marginLeft: 4,\n  },\n\n  downloadMedia: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    backgroundColor: \"inherit\",\n    padding: 10,\n  },\n}));\n\nconst reducer = (state, action) => {\n  if (action.type === \"LOAD_MESSAGES\") {\n    const messages = action.payload;\n    const newMessages = [];\n\n    messages.forEach((message) => {\n      const messageIndex = state.findIndex((m) => m.id === message.id);\n      if (messageIndex !== -1) {\n        state[messageIndex] = message;\n      } else {\n        newMessages.push(message);\n      }\n    });\n\n    return [...newMessages, ...state];\n  }\n\n  if (action.type === \"ADD_MESSAGE\") {\n    const newMessage = action.payload;\n    const messageIndex = state.findIndex((m) => m.id === newMessage.id);\n\n    if (messageIndex !== -1) {\n      state[messageIndex] = newMessage;\n    } else {\n      state.push(newMessage);\n    }\n\n    return [...state];\n  }\n\n  if (action.type === \"UPDATE_MESSAGE\") {\n    const messageToUpdate = action.payload;\n    const messageIndex = state.findIndex((m) => m.id === messageToUpdate.id);\n\n    if (messageIndex !== -1) {\n      state[messageIndex] = messageToUpdate;\n    }\n\n    return [...state];\n  }\n\n  if (action.type === \"RESET\") {\n    return [];\n  }\n};\n\nconst MessagesList = ({ ticketId, isGroup }) => {\n  const classes = useStyles();\n\n  const [messagesList, dispatch] = useReducer(reducer, []);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [hasMore, setHasMore] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const lastMessageRef = useRef();\n\n  const [selectedMessage, setSelectedMessage] = useState({});\n  const [anchorEl, setAnchorEl] = useState(null);\n  const messageOptionsMenuOpen = Boolean(anchorEl);\n  const currentTicketId = useRef(ticketId);\n\n  useEffect(() => {\n    dispatch({ type: \"RESET\" });\n    setPageNumber(1);\n\n    currentTicketId.current = ticketId;\n  }, [ticketId]);\n\n  useEffect(() => {\n    setLoading(true);\n    const delayDebounceFn = setTimeout(() => {\n      const fetchMessages = async () => {\n        try {\n          const { data } = await api.get(\"/messages/\" + ticketId, {\n            params: { pageNumber },\n          });\n\n          if (currentTicketId.current === ticketId) {\n            dispatch({ type: \"LOAD_MESSAGES\", payload: data.messages });\n            setHasMore(data.hasMore);\n            setLoading(false);\n          }\n\n          if (pageNumber === 1 && data.messages.length > 1) {\n            scrollToBottom();\n          }\n        } catch (err) {\n          setLoading(false);\n          toastError(err);\n        }\n      };\n      fetchMessages();\n    }, 500);\n    return () => {\n      clearTimeout(delayDebounceFn);\n    };\n  }, [pageNumber, ticketId]);\n\n  useEffect(() => {\n    const socket = openSocket();\n\n    socket.on(\"ready\", () => socket.emit(\"joinChatBox\", ticketId));\n\n    socket.on(\"appMessage\", (data) => {\n      if (data.action === \"create\") {\n        dispatch({ type: \"ADD_MESSAGE\", payload: data.message });\n        scrollToBottom();\n      }\n\n      if (data.action === \"update\") {\n        dispatch({ type: \"UPDATE_MESSAGE\", payload: data.message });\n      }\n    });\n\n    return () => {\n      socket.disconnect();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ticketId]);\n\n  const loadMore = () => {\n    setPageNumber((prevPageNumber) => prevPageNumber + 1);\n  };\n\n  const scrollToBottom = () => {\n    if (lastMessageRef.current) {\n      lastMessageRef.current.scrollIntoView({});\n    }\n  };\n\n  const handleScroll = (e) => {\n    if (!hasMore) return;\n    const { scrollTop } = e.currentTarget;\n\n    if (scrollTop === 0) {\n      document.getElementById(\"messagesList\").scrollTop = 1;\n    }\n\n    if (loading) {\n      return;\n    }\n\n    if (scrollTop < 50) {\n      loadMore();\n    }\n  };\n\n  const handleOpenMessageOptionsMenu = (e, message) => {\n    setAnchorEl(e.currentTarget);\n    setSelectedMessage(message);\n  };\n\n  const handleCloseMessageOptionsMenu = (e) => {\n    setAnchorEl(null);\n  };\n\n  const checkMessageMedia = (message) => {\n\n    if (message.mediaType === \"locationMessage\" && message.body.split('|').length >= 2) {\n      try {\n        let locationParts = message.body.split('|')\n        let imageLocation = locationParts[0]\n        let linkLocation = locationParts[1]\n\n        let descriptionLocation = null\n\n        if (locationParts.length > 2) {\n          descriptionLocation = message?.body?.split('|')[2]\n        }\n        return <LocationPreview image={imageLocation} link={linkLocation} description={descriptionLocation} />\n      } catch (err) {\n        console.log(\"checkMessageMedia ~ err\", err)\n\n      }\n    } else\n      if (message.mediaType === \"contactMessage\") {\n        let array = message.body.split(\"\\n\");\n        let obj = [];\n        let contact = \"\";\n        for (let index = 0; index < array.length; index++) {\n          const v = array[index];\n          let values = v.split(\":\");\n          for (let ind = 0; ind < values.length; ind++) {\n            if (values[ind].indexOf(\"+\") !== -1) {\n              obj.push({ number: values[ind] });\n            }\n            if (values[ind].indexOf(\"FN\") !== -1) {\n              contact = values[ind + 1];\n            }\n          }\n        }\n        return <VcardPreview contact={contact} numbers={obj[0].number} />\n      }\n      /*else if (message.mediaType === \"multi_vcard\") {\n     \n      \t\n        if(message.body !== null && message.body !== \"\") {\n          let newBody = JSON.parse(message.body)\n          return (\n            <>\n              {\n              newBody.map(v => (\n                <VcardPreview contact={v.name} numbers={v.number} />\n              ))\n              }\n            </>\n          )\n        } else return (<></>)\n      }*/\n      else if (message.mediaType === \"image\") {\n\n        return <ModalImageCors imageUrl={message.mediaUrl} />;\n      } else if (message.mediaType === \"audio\") {\n        return (\n          <audio controls>\n            <source src={message.mediaUrl} type=\"audio/ogg\"></source>\n          </audio>\n        );\n      } else if (message.mediaType === \"video\") {\n\n        return (\n          <video\n            className={classes.messageMedia}\n            src={message.mediaUrl}\n            controls\n          />\n        );\n      } else {\n\n        return (\n          <>\n            <div className={classes.downloadMedia}>\n              <Button\n                startIcon={<GetApp />}\n                color=\"primary\"\n                variant=\"outlined\"\n                target=\"_blank\"\n                href={message.mediaUrl}\n              >\n                Download\n              </Button>\n            </div>\n            <Divider />\n          </>\n        );\n      }\n  };\n\n  const renderMessageAck = (message) => {\n    if (message.ack === 0) {\n      return <AccessTime fontSize=\"small\" className={classes.ackIcons} />;\n    }\n    if (message.ack === 1) {\n      return <Done fontSize=\"small\" className={classes.ackIcons} />;\n    }\n    if (message.ack === 2) {\n      return <Done fontSize=\"small\" className={classes.ackIcons} />;\n    }\n    if (message.ack === 3) {\n      return <DoneAll fontSize=\"small\" className={classes.ackIcons} />;\n    }\n    if (message.ack === 4 || message.ack === 5) {\n      return <DoneAll fontSize=\"small\" className={classes.ackDoneAllIcon} />;\n    }\n  };\n\n  const renderDailyTimestamps = (message, index) => {\n    if (index === 0) {\n      return (\n        <span\n          className={classes.dailyTimestamp}\n          key={`timestamp-${message.id}`}\n        >\n          <div className={classes.dailyTimestampText}>\n            {format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")}\n          </div>\n        </span>\n      );\n    }\n    if (index < messagesList.length - 1) {\n      let messageDay = parseISO(messagesList[index].createdAt);\n      let previousMessageDay = parseISO(messagesList[index - 1].createdAt);\n\n      if (!isSameDay(messageDay, previousMessageDay)) {\n        return (\n          <span\n            className={classes.dailyTimestamp}\n            key={`timestamp-${message.id}`}\n          >\n            <div className={classes.dailyTimestampText}>\n              {format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")}\n            </div>\n          </span>\n        );\n      }\n    }\n    if (index === messagesList.length - 1) {\n      return (\n        <div\n          key={`ref-${message.createdAt}`}\n          ref={lastMessageRef}\n          style={{ float: \"left\", clear: \"both\" }}\n        />\n      );\n    }\n  };\n\n  const renderMessageDivider = (message, index) => {\n    if (index < messagesList.length && index > 0) {\n      let messageUser = messagesList[index].fromMe;\n      let previousMessageUser = messagesList[index - 1].fromMe;\n\n      if (messageUser !== previousMessageUser) {\n        return (\n          <span style={{ marginTop: 16 }} key={`divider-${message.id}`}></span>\n        );\n      }\n    }\n  };\n\n  const renderNumberTicket = (message, index) => {\n    if (index < messagesList.length && index > 0) {\n      let messageTicket = message.ticketId;\n      let previousMessageTicket = messagesList[index - 1].ticketId;\n      if (messageTicket !== previousMessageTicket) {\n        return (\n          <div key={`ticket-${message.id}`} className={classes.ticketNunber}>\n            #ticket: {messageTicket}\n            <hr />\n          </div>\n        );\n      }\n    }\n  };\n\n  const renderQuotedMessage = (message) => {\n    return (\n      <div\n        className={clsx(classes.quotedContainerLeft, {\n          [classes.quotedContainerRight]: message.fromMe,\n        })}\n      >\n        <span\n          className={clsx(classes.quotedSideColorLeft, {\n            [classes.quotedSideColorRight]: message.quotedMsg?.fromMe,\n          })}\n        ></span>\n        <div className={classes.quotedMsg}>\n          {!message.quotedMsg?.fromMe && (\n            <span className={classes.messageContactName}>\n              {message.quotedMsg?.contact?.name}\n            </span>\n          )}\n          {message.quotedMsg?.body}\n        </div>\n      </div>\n    );\n  };\n\n  const renderMessages = () => {\n    if (messagesList.length > 0) {\n      const viewMessagesList = messagesList.map((message, index) => {\n        if (message.mediaType === \"call_log\") {\n          return (\n            <React.Fragment key={message.id}>\n              {renderDailyTimestamps(message, index)}\n              {renderMessageDivider(message, index)}\n              {renderNumberTicket(message, index)}\n              <div className={classes.messageCenter}>\n                <IconButton\n                  variant=\"contained\"\n                  size=\"small\"\n                  id=\"messageActionsButton\"\n                  disabled={message.isDeleted}\n                  className={classes.messageActionsButton}\n                  onClick={(e) => handleOpenMessageOptionsMenu(e, message)}\n                >\n                  <ExpandMore />\n                </IconButton>\n                {isGroup && (\n                  <span className={classes.messageContactName}>\n                    {message.contact?.name}\n                  </span>\n                )}\n                <div>\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 17\" width=\"20\" height=\"17\">\n                    <path fill=\"#df3333\" d=\"M18.2 12.1c-1.5-1.8-5-2.7-8.2-2.7s-6.7 1-8.2 2.7c-.7.8-.3 2.3.2 2.8.2.2.3.3.5.3 1.4 0 3.6-.7 3.6-.7.5-.2.8-.5.8-1v-1.3c.7-1.2 5.4-1.2 6.4-.1l.1.1v1.3c0 .2.1.4.2.6.1.2.3.3.5.4 0 0 2.2.7 3.6.7.2 0 1.4-2 .5-3.1zM5.4 3.2l4.7 4.6 5.8-5.7-.9-.8L10.1 6 6.4 2.3h2.5V1H4.1v4.8h1.3V3.2z\"></path>\n                  </svg> <span>Chamada de voz/vdeo perdida s {format(parseISO(message.createdAt), \"HH:mm\")}</span>\n                </div>\n              </div>\n            </React.Fragment>\n          );\n        }\n        if (!message.fromMe) {\n          return (\n            <React.Fragment key={message.id}>\n              {renderDailyTimestamps(message, index)}\n              {renderMessageDivider(message, index)}\n              {renderNumberTicket(message, index)}\n              <div className={classes.messageLeft}>\n                <IconButton\n                  variant=\"contained\"\n                  size=\"small\"\n                  id=\"messageActionsButton\"\n                  disabled={message.isDeleted}\n                  className={classes.messageActionsButton}\n                  onClick={(e) => handleOpenMessageOptionsMenu(e, message)}\n                >\n                  <ExpandMore />\n                </IconButton>\n                {isGroup && (\n                  <span className={classes.messageContactName}>\n                    {message.contact?.name}\n                  </span>\n                )}\n                {(message.mediaUrl || message.mediaType === \"contactMessage\" || message.mediaType === \"locationMessage\"\n                  //|| message.mediaType === \"multi_vcard\" \n                ) && checkMessageMedia(message)}\n                \n                <div className={classes.textContentItem}>\n                  {message.quotedMsg && renderQuotedMessage(message)}\n                  <MarkdownWrapper>{message.body}</MarkdownWrapper>\n                  <span className={classes.timestamp}>\n                    {format(parseISO(message.createdAt), \"HH:mm\")}\n                  </span>\n                </div>\n              </div>\n            </React.Fragment>\n          );\n        } else {\n          return (\n            <React.Fragment key={message.id}>\n              {renderDailyTimestamps(message, index)}\n              {renderMessageDivider(message, index)}\n              {renderNumberTicket(message, index)}\n              <div className={classes.messageRight}>\n                <IconButton\n                  variant=\"contained\"\n                  size=\"small\"\n                  id=\"messageActionsButton\"\n                  disabled={message.isDeleted}\n                  className={classes.messageActionsButton}\n                  onClick={(e) => handleOpenMessageOptionsMenu(e, message)}\n                >\n                  <ExpandMore />\n                </IconButton>\n                {(message.mediaUrl || message.mediaType === \"contactMessage\" || message.mediaType === \"locationMessage\"\n                  //|| message.mediaType === \"multi_vcard\" \n                ) && checkMessageMedia(message)}\n                <div\n                  className={clsx(classes.textContentItem, {\n                    [classes.textContentItemDeleted]: message.isDeleted,\n                  })}\n                >\n                  {message.isDeleted && (\n                    <Block\n                      color=\"disabled\"\n                      fontSize=\"small\"\n                      className={classes.deletedIcon}\n                    />\n                  )}\n                  {message.quotedMsg && renderQuotedMessage(message)}\n                  <MarkdownWrapper>{message.body}</MarkdownWrapper>\n                  <span className={classes.timestamp}>\n                    {format(parseISO(message.createdAt), \"HH:mm\")}\n                    {renderMessageAck(message)}\n                  </span>\n                </div>\n              </div>\n            </React.Fragment>\n          );\n        }\n      });\n      return viewMessagesList;\n    } else {\n      return <div>Say hello to your new contact!</div>;\n    }\n  };\n\n  return (\n    <div className={classes.messagesListWrapper}>\n      <MessageOptionsMenu\n        message={selectedMessage}\n        anchorEl={anchorEl}\n        menuOpen={messageOptionsMenuOpen}\n        handleClose={handleCloseMessageOptionsMenu}\n      />\n      <div\n        id=\"messagesList\"\n        className={classes.messagesList}\n        onScroll={handleScroll}\n      >\n        {messagesList.length > 0 ? renderMessages() : []}\n      </div>\n      {loading && (\n        <div>\n          <CircularProgress className={classes.circleLoading} />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default MessagesList;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}