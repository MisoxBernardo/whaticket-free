{"ast":null,"code":"var _jsxFileName = \"/home/user/whaticket-free/frontend/src/components/QrcodeModal/index.js\";\nimport React, { useEffect, useState } from \"react\";\nimport QRCode from \"qrcode.react\";\nimport openSocket from \"../../services/socket-io\";\nimport toastError from \"../../errors/toastError\";\nimport { Dialog, DialogContent, Paper, Typography } from \"@material-ui/core\";\nimport { i18n } from \"../../translate/i18n\";\nimport api from \"../../services/api\";\nconst QrcodeModal = ({\n  open,\n  onClose,\n  whatsAppId\n}) => {\n  const [qrCode, setQrCode] = useState(\"\");\n  useEffect(() => {\n    const fetchSession = async () => {\n      if (!whatsAppId) return;\n      try {\n        const {\n          data\n        } = await api.get(`/whatsapp/${whatsAppId}`);\n        setQrCode(data.qrcode);\n      } catch (err) {\n        toastError(err);\n      }\n    };\n    fetchSession();\n  }, [whatsAppId]);\n  useEffect(() => {\n    if (!whatsAppId) return;\n    const socket = openSocket();\n    socket.on(\"whatsappSession\", data => {\n      if (data.action === \"update\" && data.session.id === whatsAppId) {\n        setQrCode(data.session.qrcode);\n      }\n      if (data.action === \"update\" && data.session.qrcode === \"\") {\n        onClose();\n      }\n    });\n    return () => {\n      socket.disconnect();\n    };\n  }, [whatsAppId, onClose]);\n  return /*#__PURE__*/React.createElement(Dialog, {\n    open: open,\n    onClose: onClose,\n    maxWidth: \"lg\",\n    scroll: \"paper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(Paper, {\n    elevation: 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    color: \"primary\",\n    gutterBottom: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 6\n    }\n  }, i18n.t(\"qrCode.message\")), qrCode ? /*#__PURE__*/React.createElement(QRCode, {\n    value: qrCode,\n    size: 256,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 7\n    }\n  }) : /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }\n  }, \"Waiting for QR Code\"))));\n};\nexport default React.memo(QrcodeModal);","map":{"version":3,"names":["React","useEffect","useState","QRCode","openSocket","toastError","Dialog","DialogContent","Paper","Typography","i18n","api","QrcodeModal","open","onClose","whatsAppId","qrCode","setQrCode","fetchSession","data","get","qrcode","err","socket","on","action","session","id","disconnect","createElement","maxWidth","scroll","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","elevation","color","gutterBottom","t","value","size","memo"],"sources":["/home/user/whaticket-free/frontend/src/components/QrcodeModal/index.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport QRCode from \"qrcode.react\";\nimport openSocket from \"../../services/socket-io\";\nimport toastError from \"../../errors/toastError\";\n\nimport { Dialog, DialogContent, Paper, Typography } from \"@material-ui/core\";\nimport { i18n } from \"../../translate/i18n\";\nimport api from \"../../services/api\";\n\nconst QrcodeModal = ({ open, onClose, whatsAppId }) => {\n\tconst [qrCode, setQrCode] = useState(\"\");\n\n\tuseEffect(() => {\n\t\tconst fetchSession = async () => {\n\t\t\tif (!whatsAppId) return;\n\n\t\t\ttry {\n\t\t\t\tconst { data } = await api.get(`/whatsapp/${whatsAppId}`);\n\t\t\t\tsetQrCode(data.qrcode);\n\t\t\t} catch (err) {\n\t\t\t\ttoastError(err);\n\t\t\t}\n\t\t};\n\t\tfetchSession();\n\t}, [whatsAppId]);\n\n\tuseEffect(() => {\n\t\tif (!whatsAppId) return;\n\t\tconst socket = openSocket();\n\n\t\tsocket.on(\"whatsappSession\", data => {\n\t\t\tif (data.action === \"update\" && data.session.id === whatsAppId) {\n\t\t\t\tsetQrCode(data.session.qrcode);\n\t\t\t}\n\n\t\t\tif (data.action === \"update\" && data.session.qrcode === \"\") {\n\t\t\t\tonClose();\n\t\t\t}\n\t\t});\n\n\t\treturn () => {\n\t\t\tsocket.disconnect();\n\t\t};\n\t}, [whatsAppId, onClose]);\n\n\treturn (\n\t\t<Dialog open={open} onClose={onClose} maxWidth=\"lg\" scroll=\"paper\">\n\t\t\t<DialogContent>\n\t\t\t\t<Paper elevation={0}>\n\t\t\t\t\t<Typography color=\"primary\" gutterBottom>\n\t\t\t\t\t\t{i18n.t(\"qrCode.message\")}\n\t\t\t\t\t</Typography>\n\t\t\t\t\t{qrCode ? (\n\t\t\t\t\t\t<QRCode value={qrCode} size={256} />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<span>Waiting for QR Code</span>\n\t\t\t\t\t)}\n\t\t\t\t</Paper>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n};\n\nexport default React.memo(QrcodeModal);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}